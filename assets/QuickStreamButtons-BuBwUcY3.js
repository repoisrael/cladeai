import{n as N,b as _,a as F,r as v,al as M,j as p,i as Y,m as U}from"./index-BVR2Ma7G.js";import{g as E}from"./providers-CHelMshW.js";import{M as H}from"./music-Bc5CZPt6.js";const P="https://www.googleapis.com/youtube/v3";function q(e){if(!e)return null;const r=e.trim();if(/^[a-zA-Z0-9_-]{11}$/.test(r))return r;const o=e.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/);if(o!=null&&o[1])return o[1];const t=e.match(/[?&]v=([a-zA-Z0-9_-]{11})/);return t!=null&&t[1]?t[1]:null}async function k(e){var t,u,a,l,n,c;const r="AIzaSyCuzsSgHYzMsRfDWHtGFlDhkYJfysD8DYw",o=new URLSearchParams({part:"snippet,contentDetails",id:e,key:r});try{const f=await fetch(`${P}/videos?${o}`);if(!f.ok)return null;const h=(t=(await f.json()).items)==null?void 0:t[0];if(!h)return null;const i=h.snippet.title||"",[S,y]=i.includes(" - ")?i.split(" - ",2):[void 0,i],b=((u=h.contentDetails)==null?void 0:u.duration)||"",w=Q(b);return{id:`youtube:${e}`,title:y||i,artist:S||h.snippet.channelTitle,cover_url:((l=(a=h.snippet.thumbnails)==null?void 0:a.high)==null?void 0:l.url)||((c=(n=h.snippet.thumbnails)==null?void 0:n.default)==null?void 0:c.url),youtube_id:e,duration_ms:w,provider:"youtube"}}catch(f){return console.error("getYouTubeVideo error",f),null}}function Q(e){try{const r=e.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);if(!r)return 0;const o=parseInt(r[1]||"0",10),t=parseInt(r[2]||"0",10),u=parseInt(r[3]||"0",10);return(o*3600+t*60+u)*1e3}catch{return 0}}async function V(e,r){const o="AIzaSyCuzsSgHYzMsRfDWHtGFlDhkYJfysD8DYw";try{const t=[],u=q(r?`${e} ${r}`:e);if(u){const i=await W(u,o);if(i)return[{videoId:u,title:i.title,channel:i.channel,type:"official"}]}const a=`${e} ${r} official`.trim(),l=await j(a,o,3);t.push(...l.map(i=>({...i,type:"official"})));const n=`${e} ${r} live`.trim(),c=await j(n,o,2);t.push(...c.map(i=>({...i,type:"live"})));const f=`${r||e} cover`.trim(),g=await j(f,o,2);return t.push(...g.map(i=>({...i,type:"cover"}))),t.filter((i,S,y)=>y.findIndex(b=>b.videoId===i.videoId)===S)}catch(t){return console.error("Error searching YouTube:",t),[]}}async function j(e,r,o){const t=new URLSearchParams({part:"snippet",q:e,type:"video",videoCategoryId:"10",maxResults:o.toString(),key:r}),u=await fetch(`${P}/search?${t}`);return u.ok?(await u.json()).items.map(l=>({videoId:l.id.videoId,title:l.snippet.title,channel:l.snippet.channelTitle})):(console.error("YouTube API error:",u.status),[])}async function W(e,r){var l,n,c;const o=new URLSearchParams({part:"snippet",id:e,key:r}),t=await fetch(`${P}/videos?${o}`);if(!t.ok)return null;const a=(l=(await t.json()).items)==null?void 0:l[0];return a?{title:((n=a.snippet)==null?void 0:n.title)||"YouTube video",channel:((c=a.snippet)==null?void 0:c.channelTitle)||"YouTube"}:null}const Z=({className:e})=>p.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})}),G=({className:e})=>p.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})});function X({track:e,canonicalTrackId:r=null,trackTitle:o="Track",trackArtist:t,className:u,size:a="md"}){const l=E(e),n=l.find(s=>s.provider==="spotify"),c=l.find(s=>s.provider==="youtube");N();const{openPlayer:f,positionMs:g,provider:h,canonicalTrackId:i}=_(),{user:S}=F(),y=v.useCallback(s=>{if(!s)return null;if(s.startsWith("spotify:track:"))return s.split(":").pop()||null;const d=s.match(/track\/(\w+)/);return d!=null&&d[1]?d[1]:s.includes("?")?s.split("?")[0].split("/").pop()||null:s},[]),b=v.useCallback(s=>{if(!s)return null;const d=s.match(/[?&]v=([A-Za-z0-9_-]{11})/);return d!=null&&d[1]?d[1]:(s.length===11,s)},[]),w=v.useMemo(()=>y(e.spotifyId||e.urlSpotifyWeb||e.urlSpotifyApp||(n==null?void 0:n.webUrl)||(n==null?void 0:n.appUrl)),[y,e.spotifyId,e.urlSpotifyApp,e.urlSpotifyWeb,n==null?void 0:n.appUrl,n==null?void 0:n.webUrl]),T=v.useMemo(()=>b(e.youtubeId||e.urlYoutube||(c==null?void 0:c.webUrl)),[b,e.urlYoutube,e.youtubeId,c==null?void 0:c.webUrl]),m=!!w,x=!!T,A=!m&&!x,C=i===r,I=C&&g?g/1e3:void 0,R=v.useCallback(()=>{!m||!e.spotifyId||(M("spotify"),f({canonicalTrackId:r,provider:"spotify",providerTrackId:w,autoplay:!0,context:"quick-stream",title:o,artist:t,startSec:I}))},[m,r,o,t,f,I,w]),B=v.useCallback(async()=>{var d;M("youtube");let s=T;if(!s)try{s=(d=(await V(t||"",o||""))[0])==null?void 0:d.videoId}catch(D){console.warn("YouTube search failed; falling back to no-op",D)}if(!s){console.warn("No YouTube result found for track; cannot play");return}f({canonicalTrackId:r,provider:"youtube",providerTrackId:s,autoplay:!0,context:"quick-stream",title:o,artist:t,startSec:I})},[r,o,t,f,I,T]),$={sm:"w-8 h-8",md:"w-10 h-10",lg:"w-12 h-12"},z={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return A?p.jsxs("div",{className:Y("flex items-center gap-2 text-muted-foreground",u),children:[p.jsx(H,{className:"w-4 h-4"}),p.jsx("span",{className:"text-sm",children:"No streaming links"})]}):p.jsxs("div",{className:Y("flex items-center gap-2",u),children:[p.jsx(U.button,{whileHover:{scale:m?1.05:1},whileTap:{scale:m?.97:1},onClick:m?R:void 0,"data-provider":"spotify",disabled:!m,className:Y($[a],"rounded-full flex items-center justify-center transition-all",m?"bg-gradient-to-br from-[#1DB954] to-[#1ed760] text-white shadow-lg hover:shadow-xl hover:from-[#1ed760] hover:to-[#1DB954] cursor-pointer":"bg-muted text-muted-foreground cursor-not-allowed opacity-60",h==="spotify"&&C&&"ring-2 ring-white ring-offset-2 ring-offset-background"),title:m?"Play in Spotify":"Spotify unavailable","aria-label":m?`Play ${o} in Spotify`:"Spotify unavailable",children:p.jsx(Z,{className:z[a]})}),p.jsx(U.button,{whileHover:{scale:x?1.05:1},whileTap:{scale:x?.97:1},onClick:B,"data-provider":"youtube",className:Y($[a],"rounded-full flex items-center justify-center transition-all","bg-gradient-to-br from-[#FF0000] to-[#CC0000] text-white shadow-lg hover:shadow-xl hover:from-[#FF0000] hover:to-[#EE0000] cursor-pointer",h==="youtube"&&C&&"ring-2 ring-white ring-offset-2 ring-offset-background"),title:x?"Play on YouTube":"Find on YouTube","aria-label":x?`Play ${o} on YouTube`:`Find ${o} on YouTube`,children:p.jsx(G,{className:z[a]})})]})}export{X as Q,Z as S,k as g,V as s};
