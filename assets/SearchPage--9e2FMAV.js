import{c as ae,u as le,a as ie,r as o,j as e,B as f,m as p,X as L,g as ne,P as F}from"./index-Dd2rIlyv.js";import{B as oe}from"./BottomNav-3dyL0Vl5.js";import{C as G}from"./ChordBadge-xItg397v.js";import{I as ce}from"./input-BiA0strX.js";import{B as g}from"./badge-DmFa1swO.js";import{s as N,p as de}from"./seedTracks-B22TRa5Y.js";import{n as U}from"./navigation-PB9wrqL7.js";import{s as me,a as ue}from"./youtubeSearchService-QZoAF1Jp.js";import{a as he,R as J}from"./useSpotifyUser-DdnNOCC7.js";import{M as R}from"./music-rEZJDJ1O.js";import{T as Q}from"./trending-up-DbXw-0qM.js";import{S as $}from"./search-CInHvpnX.js";import{A as xe}from"./index-DZlwEVhM.js";import{Z as X}from"./zap-Dyhy7yS-.js";import{H as Z}from"./heart-gI87XFQe.js";import{S as fe}from"./sparkles-DbqwZ06P.js";import{C as pe}from"./clock-B9SuAwWE.js";import{A as ge}from"./arrow-right-Bph914GJ.js";import{E as K}from"./external-link-BAe6qj8e.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=ae("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),A="clade_search_history",ye=20;function k(){try{const c=localStorage.getItem(A);return c?JSON.parse(c).sort((h,a)=>a.timestamp-h.timestamp):[]}catch(c){return console.error("Error loading search history:",c),[]}}function Ne(c){try{const d=k();if(d.slice(0,5).some(n=>n.query.toLowerCase()===c.query.toLowerCase()&&n.type===c.type))return;const v=[{...c,id:`${Date.now()}-${Math.random()}`,timestamp:Date.now()},...d].slice(0,ye);localStorage.setItem(A,JSON.stringify(v))}catch(d){console.error("Error saving search history:",d)}}function ve(c){try{const h=k().filter(a=>a.id!==c);localStorage.setItem(A,JSON.stringify(h))}catch(d){console.error("Error removing from search history:",d)}}function De(){const c=le(),{user:d}=ie(),{data:h}=he(),[a,v]=o.useState(""),[n,z]=o.useState("song"),[j,E]=o.useState([]),[ee,H]=o.useState([]),[B,M]=o.useState(!1),[W,P]=o.useState([]),[x,w]=o.useState([]),[m,_]=o.useState("all"),[u,T]=o.useState("all"),[D,se]=o.useState(!1);o.useEffect(()=>{P(k())},[]),o.useEffect(()=>{console.log("ðŸ” SearchPage mounted"),console.log("ðŸ“Š seedTracks count:",N.length),console.log("ðŸ“¦ First track:",N[0])},[]),o.useEffect(()=>{if(n!=="song"||!a.trim()||!d||!h){E([]);return}const s=setTimeout(async()=>{M(!0);try{const t=await me(d.id,a,20);E(t)}catch(t){console.error("Spotify search error:",t),E([])}finally{M(!1)}},300);return()=>clearTimeout(s)},[a,n,d,h]),o.useEffect(()=>{let s=!1;if(n!=="song"||!a.trim()||h){H([]);return}const t=setTimeout(async()=>{try{const r=await ue(a,"");if(s)return;const l=r.map(i=>({id:`youtube:${i.videoId}`,title:i.title,artist:i.channel,youtube_id:i.videoId,provider:"youtube"}));H(l)}catch(r){console.error("YouTube search error:",r),H([])}},300);return()=>{s=!0,clearTimeout(t)}},[a,n,h]);const y=o.useMemo(()=>{let s=[];if(n==="song"){const t=a.toLowerCase();s=N.filter(r=>{var l,i,b,C,S;return!a.trim()||((l=r.title)==null?void 0:l.toLowerCase().includes(t))||((i=r.artist)==null?void 0:i.toLowerCase().includes(t))||((b=r.album)==null?void 0:b.toLowerCase().includes(t))||((C=r.genre)==null?void 0:C.toLowerCase().includes(t))||((S=r.genre_description)==null?void 0:S.toLowerCase().includes(t))})}else{const t=a.toUpperCase().split(/[-â€“â€”,\s]+/).map(r=>r.trim()).filter(Boolean);s=N.filter(r=>{if(!r.progression_roman)return!1;const l=r.progression_roman.map(i=>i.toUpperCase());return t.length===0||t.every(i=>l.includes(i)||l.includes(i.toLowerCase()))})}if(x.length>0&&(s=s.filter(t=>{const r=[t.genre,...t.genres||[]].filter(Boolean).map(l=>l==null?void 0:l.toLowerCase());return x.some(l=>r.some(i=>i==null?void 0:i.includes(l.toLowerCase())))})),m!=="all"&&(s=s.filter(t=>typeof t.energy!="number"?!1:m==="high"?t.energy>.7:m==="medium"?t.energy>=.4&&t.energy<=.7:m==="low"?t.energy<.4:!0)),u!=="all"&&(s=s.filter(t=>typeof t.valence!="number"?!1:u==="happy"?t.valence>.6:u==="sad"?t.valence<.4:u==="neutral"?t.valence>=.4&&t.valence<=.6:!0)),a.trim()&&n==="song"){const t=a.toLowerCase();return s.sort((r,l)=>{var O,V,Y,q;const i=((O=r.title)==null?void 0:O.toLowerCase())||"",b=((V=l.title)==null?void 0:V.toLowerCase())||"",C=((Y=r.artist)==null?void 0:Y.toLowerCase())||"",S=((q=l.artist)==null?void 0:q.toLowerCase())||"";return i.startsWith(t)&&!b.startsWith(t)?-1:!i.startsWith(t)&&b.startsWith(t)?1:C.startsWith(t)&&!S.startsWith(t)?-1:!C.startsWith(t)&&S.startsWith(t)?1:0})}return s},[a,n,x,m,u]),I=s=>{a.trim()&&(Ne({query:a.trim(),type:n,track:n==="song"?s:void 0}),P(k()));const t=s.id||s.spotify_id||s.external_id;t&&U(c,t)},te=(s,t)=>{t.stopPropagation(),ve(s),P(k())},re=s=>{s.track?U(c,s.track.id):(v(s.query),z(s.type))};return e.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 glass-strong safe-top",children:e.jsx(J,{maxWidth:"full",children:e.jsxs("div",{className:"py-4 space-y-3",children:[e.jsx("h1",{className:"text-xl lg:text-2xl font-bold",children:"Search"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:n==="song"?"default":"outline",size:"sm",onClick:()=>z("song"),className:"flex-1",children:[e.jsx(R,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Song / Artist"}),e.jsx("span",{className:"sm:hidden",children:"Song"})]}),e.jsxs(f,{variant:n==="chord"?"default":"outline",size:"sm",onClick:()=>z("chord"),className:"flex-1",children:[e.jsx(Q,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Chord Progression"}),e.jsx("span",{className:"sm:hidden",children:"Chords"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(ce,{placeholder:n==="song"?"Search songs or artists...":"e.g., vi-IV-I-V or I-V-vi-IV",value:a,onChange:s=>v(s.target.value),className:"pl-10 bg-muted/50",autoFocus:!0})]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>se(!D),className:"w-full",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Filters",(x.length>0||m!=="all"||u!=="all")&&e.jsx(g,{variant:"secondary",className:"ml-2",children:x.length+(m!=="all"?1:0)+(u!=="all"?1:0)})]}),e.jsx(xe,{children:D&&e.jsx(p.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Genre",x.length>0&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>w([]),className:"h-6 text-xs",children:"Clear"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["pop","rock","hip hop","r&b","jazz","funk","soul","blues","country","disco","synthpop","reggae","punk"].map(s=>e.jsx(g,{variant:x.includes(s)?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{w(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},children:s},s))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Energy"]}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"All"},{value:"high",label:"High Energy"},{value:"medium",label:"Medium"},{value:"low",label:"Chill"}].map(s=>e.jsx(g,{variant:m===s.value?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>_(s.value),children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Mood"]}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"All",icon:fe},{value:"happy",label:"Happy",icon:"ðŸ˜Š"},{value:"neutral",label:"Neutral",icon:"ðŸ˜"},{value:"sad",label:"Melancholic",icon:"ðŸ˜¢"}].map(s=>e.jsxs(g,{variant:u===s.value?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>T(s.value),children:[typeof s.icon=="string"?s.icon:""," ",s.label]},s.value))})]})]})})})]})})}),e.jsx("main",{className:"py-4 space-y-6",children:e.jsxs(J,{maxWidth:"full",children:[!a&&W.length>0&&e.jsxs("section",{children:[e.jsxs("h2",{className:"text-sm font-semibold text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Recent Searches"]}),e.jsx("div",{className:"space-y-2",children:W.slice(0,10).map((s,t)=>e.jsx(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.03},onClick:()=>re(s),className:"p-3 glass rounded-lg cursor-pointer hover:bg-muted/50 transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted/50 flex items-center justify-center flex-shrink-0",children:s.type==="song"?e.jsx(R,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(Q,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("div",{className:"flex-1 min-w-0",children:s.track?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium truncate",children:s.track.title}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s.track.artist})]}):e.jsx("div",{className:"font-medium",children:s.query})}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",onClick:r=>te(s.id,r),children:e.jsx(L,{className:"w-4 h-4"})})]})},s.id))})]}),n==="chord"&&!a&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Popular Progressions"}),e.jsx("div",{className:"space-y-2",children:de.slice(0,5).map((s,t)=>e.jsxs(p.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.05},onClick:()=>v(s.progression.join("-")),className:"w-full p-4 glass rounded-xl text-left group hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx(ge,{className:"w-4 h-4 text-muted-foreground group-hover:text-foreground transition-colors"})]}),e.jsx("div",{className:"flex gap-1.5 flex-wrap",children:s.progression.map((r,l)=>e.jsx(G,{chord:r,size:"sm"},l))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:s.description})]},s.name))})]}),a&&j.length===0&&y.length===0&&!B&&e.jsx("section",{children:e.jsxs("div",{className:"glass rounded-2xl p-8 text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mx-auto",children:e.jsx($,{className:"w-10 h-10 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold mb-2",children:['No results for "',a,'"']}),x.length>0||m!=="all"||u!=="all"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"No tracks match your search with the selected filters"}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{w([]),_("all"),T("all")},children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:["Searched ",N.length," tracks with chord progressions"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Try searching for artist names like "weeknd" or chord progressions like "vi-IV-I-V"'})]})]}),!h&&e.jsxs("div",{className:"glass-strong rounded-xl p-6 space-y-3 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-[#1DB954]",children:[e.jsx(K,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Unlock unlimited search"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect Spotify to search millions of songs beyond the local database"}),e.jsx(f,{onClick:()=>c("/profile"),className:"w-full bg-[#1DB954] hover:bg-[#1ed760] text-white",size:"lg",children:"Connect Spotify"})]})]})}),(j.length>0||y.length>0)&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2 flex-wrap",children:["Results (",j.length+y.length,")",B&&e.jsx(ne,{className:"w-3 h-3 animate-spin"}),j.length>0&&e.jsx("span",{className:"text-[#1DB954] text-xs",children:"via Spotify"}),y.length>0&&e.jsx("span",{className:"text-xs text-purple-500",children:"via Local DB"})]}),(x.length>0||m!=="all"||u!=="all")&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>{w([]),_("all"),T("all")},className:"h-7 text-xs",children:"Clear Filters"})]}),(x.length>0||m!=="all"||u!=="all")&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[x.map(s=>e.jsxs(g,{variant:"secondary",className:"text-xs",children:[s,e.jsx(L,{className:"w-3 h-3 ml-1 cursor-pointer",onClick:()=>w(t=>t.filter(r=>r!==s))})]},s)),m!=="all"&&e.jsxs(g,{variant:"secondary",className:"text-xs",children:[e.jsx(X,{className:"w-3 h-3 mr-1"}),m," energy",e.jsx(L,{className:"w-3 h-3 ml-1 cursor-pointer",onClick:()=>_("all")})]}),u!=="all"&&e.jsxs(g,{variant:"secondary",className:"text-xs",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),u,e.jsx(L,{className:"w-3 h-3 ml-1 cursor-pointer",onClick:()=>T("all")})]})]}),e.jsxs("div",{className:"space-y-2",children:[j.map((s,t)=>e.jsx(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>I(s),children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist}),s.album&&e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:s.album})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(F,{className:"w-4 h-4 text-muted-foreground"})})]})},s.id)),ee.map((s,t)=>e.jsx(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>I(s),children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(F,{className:"w-4 h-4 text-muted-foreground"})})]})},s.id)),y.map((s,t)=>e.jsx(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl",children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist}),s.progression_roman&&e.jsx("div",{className:"flex gap-1 mt-2 flex-wrap",children:s.progression_roman.map((r,l)=>e.jsx(G,{chord:r,size:"sm",keySignature:s.detected_key},l))})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>I(s),title:"Play on streaming service",children:e.jsx(F,{className:"w-4 h-4"})}),s.url_youtube&&e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>window.open(s.url_youtube,"_blank"),title:"Open on YouTube",children:e.jsx(K,{className:"w-3.5 h-3.5"})})]})]})},s.id))]})]}),a&&j.length===0&&y.length===0&&!B&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("p",{className:"text-muted-foreground",children:['No results found for "',a,'"']}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:!h&&d?"Connect Spotify for full catalog access":"Try a different search term"})]}),!a&&n==="song"&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Trending Tracks"}),e.jsx("div",{className:"space-y-2",children:N.slice(0,10).map((s,t)=>e.jsx(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-8 text-lg font-bold text-muted-foreground",children:t+1}),s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist})]}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 flex-shrink-0",onClick:()=>I(s),title:"Play on streaming service",children:e.jsx(F,{className:"w-4 h-4"})})]})},s.id))})]})]})}),e.jsx(oe,{})]})}export{De as default};
