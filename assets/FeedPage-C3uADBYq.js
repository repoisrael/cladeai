import{j as e,m as b,a as L,u as z,r,B as d,X as H,b as J,C as W,d as G}from"./index-DHJxnaPT.js";import{T as K}from"./TrackCard-DmF24199.js";import{u as V,S as $}from"./useTracks-B2tlfnFS.js";import{B as T}from"./BottomNav-CQIQMm4t.js";import{A as D}from"./index-D7HgWSwk.js";import{S as q}from"./sparkles-B8MCFzNK.js";import{U as O}from"./TrackComments-t-3Unh5O.js";import{u as Q,R as E}from"./useSpotifyUser-BNfOHRSX.js";import{C as Z}from"./circle-alert-rBRqTjRv.js";import{L as ee}from"./log-in-DeMjHLxg.js";import"./ChordBadge-CPUVq28D.js";import"./rotate-ccw-DvDioRmh.js";import"./avatar-DeHHhi9Z.js";import"./switch-Bo-gpGfS.js";import"./index-Bk3LTAJO.js";import"./useFollowing-BXHSkvdt.js";import"./useMutation-emqqGa5v.js";import"./label-BK-TT6u_.js";import"./users-Ck42oO20.js";import"./map-pin-TbMuVzg4.js";import"./radio-DFKCE8pU.js";import"./formatDistanceToNow-3UBXKcFR.js";import"./en-US-wfBU2YNu.js";import"./share-2-DiqKW3OB.js";import"./check-izAbpWW4.js";import"./twitter-Ct9W11S4.js";import"./send-BbrQ2bbq.js";import"./timeFormat-BXo_t6_Q.js";import"./music-2-B88W2iwL.js";import"./CladeIcon-D843Fv4c.js";import"./heart-DZ1V0Hja.js";import"./waves-Dw9gI-cY.js";import"./bookmark-BkbyPaGO.js";import"./search-z7Wgxsja.js";import"./seedTracks-B6rAh97_.js";import"./spotifySearchService-DO_2VDJj.js";import"./menu-B8sWFF9R.js";import"./textarea-gMDmdO1c.js";import"./badge-BW0nZ0If.js";import"./index-ilS6Hfhy.js";import"./chevron-right-BtaW63t8.js";import"./trash-2-AvF8-p8Q.js";function se(){return e.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 z-0",children:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-secondary to-background animate-shimmer"})}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col justify-end p-6 pb-8 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},className:"h-8 w-3/4 bg-muted/50 rounded-lg animate-shimmer"}),e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05},className:"h-6 w-1/2 bg-muted/50 rounded-lg animate-shimmer"})]}),e.jsx("div",{className:"h-12 w-36 bg-muted/50 rounded-xl animate-shimmer"}),e.jsxs("div",{className:"glass-strong rounded-2xl p-4 space-y-3",children:[e.jsx("div",{className:"h-4 w-24 bg-muted/50 rounded animate-shimmer"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(a=>e.jsx("div",{className:"h-8 w-12 bg-muted/50 rounded-lg animate-shimmer",style:{animationDelay:`${a*100}ms`}},a))})]}),e.jsx("div",{className:"flex items-center justify-between pt-4",children:[1,2,3,4,5].map(a=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 bg-muted/50 rounded-full animate-shimmer"}),e.jsx("div",{className:"w-10 h-3 bg-muted/50 rounded animate-shimmer"})]},a))})]})]})}function te(){const{guestMode:a,user:N}=L(),g=z(),[x,w]=r.useState(()=>{const v=localStorage.getItem("clade_guest_banner_dismissed");if(!v)return!1;const n=parseInt(v,10),i=24*60*60*1e3;return Date.now()-n<i}),y=a&&!N&&!x,j=()=>{w(!0),localStorage.setItem("clade_guest_banner_dismissed",Date.now().toString())},k=()=>{g("/auth")};return e.jsx(D,{children:y&&e.jsxs(b.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",damping:20,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 safe-bottom",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsx("div",{className:"absolute inset-0 bg-background/95 backdrop-blur-xl border-t border-border/50"}),e.jsxs("div",{className:"relative max-w-7xl mx-auto px-4 py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-[#00F5FF] to-[#FF00FF]",children:e.jsx(q,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-0.5",children:"Join the Conversation"}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:"Sign up to comment, like, and connect with music lovers"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(d,{size:"sm",onClick:k,className:"bg-gradient-to-r from-[#00F5FF] to-[#FF00FF] hover:opacity-90 transition-opacity shadow-lg shadow-[#00F5FF]/20",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign Up"}),e.jsx("span",{className:"sm:hidden",children:"Join"})]}),e.jsx(d,{size:"sm",variant:"ghost",onClick:j,className:"text-muted-foreground hover:text-foreground",children:e.jsx(H,{className:"w-4 h-4"})})]})]})]})})}function We(){const{user:a,loading:N}=L(),g=z(),{data:x,isLoading:w,error:y}=V(50),{data:j=[],isLoading:k}=Q([],[],50),v=(a&&j.length>0?j:x==null?void 0:x.tracks)??[],n=(()=>{const s=new Set;return v.filter(t=>{const o=t.spotify_id||t.id;return!o||s.has(o)?!1:(s.add(o),!0)})})(),[i,S]=r.useState(0),[A,M]=r.useState(new Map),I=r.useRef(null),[P,F]=r.useState(!a),{openPlayer:_}=J();r.useEffect(()=>{a&&F(!1)},[a]);const B=s=>{var o;if(!a){F(!0);return}const t=(o=n[i])==null?void 0:o.id;t&&(M(l=>{const p=new Map(l),c=new Set(l.get(t)||[]);return c.has(s)?c.delete(s):c.add(s),p.set(t,c),p}),s==="skip"&&i<n.length-1&&S(l=>l+1))},u=r.useCallback(()=>{i<n.length-1&&S(s=>s+1)},[i,n.length]),h=r.useCallback(()=>{i>0&&S(s=>s-1)},[i]);if(r.useEffect(()=>{const s=t=>{t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||(t.key==="ArrowDown"||t.key==="j"?u():(t.key==="ArrowUp"||t.key==="k")&&h())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[u,h]),r.useEffect(()=>{const s=I.current;if(!s)return;let t=0,o=0,l=0;const p=f=>{t=f.touches[0].clientY,o=f.touches[0].clientX,l=Date.now()},c=f=>{const U=f.changedTouches[0].clientY,X=f.changedTouches[0].clientX,C=t-U,Y=Math.abs(o-X),R=Date.now()-l;Math.abs(C)>50&&Math.abs(C)>Y&&R<500&&(C>0?u():h())};return s.addEventListener("touchstart",p,{passive:!0}),s.addEventListener("touchend",c,{passive:!0}),()=>{s.removeEventListener("touchstart",p),s.removeEventListener("touchend",c)}},[u,h]),N||w||k)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(se,{}),e.jsx(T,{})]});if(y)return e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsxs("div",{className:"text-center p-6",children:[e.jsx(Z,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Failed to load tracks"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try again later"})]}),e.jsx(T,{})]});const m=n[i];return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col touch-pan-y",ref:I,"data-feed":!0,children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-40 glass-strong safe-top",children:e.jsx(E,{maxWidth:"full",children:e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("h1",{className:"text-lg lg:text-xl font-bold gradient-text",children:"HarmonyFeed"}),e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsxs("span",{className:"text-xs lg:text-sm text-muted-foreground flex items-center gap-1",children:[i+1," / ",n.length]}),!a&&e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>g("/auth"),className:"gap-1.5",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign in"})]})]})]})})}),P&&!a&&e.jsx("div",{className:"pt-16 px-4",children:e.jsx("div",{className:"mx-auto max-w-3xl rounded-xl border border-border/60 bg-background/70 px-4 py-3 text-sm text-muted-foreground shadow-lg backdrop-blur",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Youâ€™re exploring in guest mode."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sign in to like, comment, follow, and save tracks. Playback and browsing stay open."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",onClick:()=>g("/auth"),children:"Sign in"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>F(!1),children:"Maybe later"})]})]})})}),e.jsxs("div",{className:"hidden md:flex fixed left-4 top-1/2 -translate-y-1/2 z-30 flex-col gap-2",children:[e.jsx(d,{variant:"outline",size:"icon",className:"glass",onClick:h,disabled:i===0,children:e.jsx(W,{className:"w-5 h-5"})}),e.jsx(d,{variant:"outline",size:"icon",className:"glass",onClick:u,disabled:i===n.length-1,children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("main",{className:"flex-1 pt-16 pb-24",children:e.jsx(E,{maxWidth:"full",className:"py-6",children:e.jsx("div",{className:"h-[calc(100vh-12rem)] max-w-lg mx-auto lg:max-w-2xl",children:e.jsx(D,{mode:"wait",children:m&&e.jsx(b.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.3},className:"h-full",children:e.jsx(K,{track:m,isActive:!0,onInteraction:B,interactions:A.get(m.id)||new Set,onPipModeActivate:(s,t)=>{s&&_({canonicalTrackId:m.id,provider:"youtube",providerTrackId:s,autoplay:!0,context:"feed",title:t,artist:m.artist})}})},m.id)})})})}),n[i]&&e.jsx($,{roomId:"global",maxVisible:3,scrollSpeed:4e3}),e.jsx(te,{}),e.jsx(T,{})]})}export{We as default};
