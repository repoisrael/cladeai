import{r as f,v as fe,j as m,F as C,z as V,x as I,D as me,ai as pe,I as he,i as ge,a as O,g as $,s as M}from"./index-BVR2Ma7G.js";import{c as X}from"./index-BdQq_4o_.js";import{u as we}from"./index-lb5VOux9.js";import{u as Se}from"./index-CUNc2gNs.js";import{u as be}from"./useMutation-BDPdP8mj.js";var G=["PageUp","PageDown"],W=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Q={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},k="Slider",[H,ve,ye]=me(k),[J]=he(k,[ye]),[xe,B]=J(k),Z=f.forwardRef((e,t)=>{const{name:r,min:n=0,max:a=100,step:s=1,orientation:o="horizontal",disabled:l=!1,minStepsBetweenThumbs:d=0,defaultValue:p=[n],value:h,onValueChange:i=()=>{},onValueCommit:u=()=>{},inverted:w=!1,form:x,...c}=e,S=f.useRef(new Set),g=f.useRef(0),v=o==="horizontal"?_e:Re,[b=[],j]=fe({prop:h,defaultProp:p,onChange:y=>{var E;(E=[...S.current][g.current])==null||E.focus(),i(y)}}),N=f.useRef(b);function T(y){const _=Me(b,y);A(y,_)}function de(y){A(y,g.current)}function ue(){const y=N.current[g.current];b[g.current]!==y&&u(b)}function A(y,_,{commit:E}={commit:!1}){const q=Ae(s),F=Ke(Math.round((y-n)/s)*s+n,q),K=X(F,[n,a]);j((D=[])=>{const R=De(D,K,_);if(je(R,d*s)){g.current=R.indexOf(K);const Y=String(R)!==String(D);return Y&&E&&u(R),Y?R:D}else return D})}return m.jsx(xe,{scope:e.__scopeSlider,name:r,disabled:l,min:n,max:a,valueIndexToChangeRef:g,thumbs:S.current,values:b,orientation:o,form:x,children:m.jsx(H.Provider,{scope:e.__scopeSlider,children:m.jsx(H.Slot,{scope:e.__scopeSlider,children:m.jsx(v,{"aria-disabled":l,"data-disabled":l?"":void 0,...c,ref:t,onPointerDown:C(c.onPointerDown,()=>{l||(N.current=b)}),min:n,max:a,inverted:w,onSlideStart:l?void 0:T,onSlideMove:l?void 0:de,onSlideEnd:l?void 0:ue,onHomeKeyDown:()=>!l&&A(n,0,{commit:!0}),onEndKeyDown:()=>!l&&A(a,b.length-1,{commit:!0}),onStepKeyDown:({event:y,direction:_})=>{if(!l){const F=G.includes(y.key)||y.shiftKey&&W.includes(y.key)?10:1,K=g.current,D=b[K],R=s*F*_;A(D+R,K,{commit:!0})}}})})})})});Z.displayName=k;var[ee,te]=J(k,{startEdge:"left",endEdge:"right",size:"width",direction:1}),_e=f.forwardRef((e,t)=>{const{min:r,max:n,dir:a,inverted:s,onSlideStart:o,onSlideMove:l,onSlideEnd:d,onStepKeyDown:p,...h}=e,[i,u]=f.useState(null),w=I(t,v=>u(v)),x=f.useRef(void 0),c=we(a),S=c==="ltr",g=S&&!s||!S&&s;function P(v){const b=x.current||i.getBoundingClientRect(),j=[0,b.width],T=U(j,g?[r,n]:[n,r]);return x.current=b,T(v-b.left)}return m.jsx(ee,{scope:e.__scopeSlider,startEdge:g?"left":"right",endEdge:g?"right":"left",direction:g?1:-1,size:"width",children:m.jsx(re,{dir:c,"data-orientation":"horizontal",...h,ref:w,style:{...h.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:v=>{const b=P(v.clientX);o==null||o(b)},onSlideMove:v=>{const b=P(v.clientX);l==null||l(b)},onSlideEnd:()=>{x.current=void 0,d==null||d()},onStepKeyDown:v=>{const j=Q[g?"from-left":"from-right"].includes(v.key);p==null||p({event:v,direction:j?-1:1})}})})}),Re=f.forwardRef((e,t)=>{const{min:r,max:n,inverted:a,onSlideStart:s,onSlideMove:o,onSlideEnd:l,onStepKeyDown:d,...p}=e,h=f.useRef(null),i=I(t,h),u=f.useRef(void 0),w=!a;function x(c){const S=u.current||h.current.getBoundingClientRect(),g=[0,S.height],v=U(g,w?[n,r]:[r,n]);return u.current=S,v(c-S.top)}return m.jsx(ee,{scope:e.__scopeSlider,startEdge:w?"bottom":"top",endEdge:w?"top":"bottom",size:"height",direction:w?1:-1,children:m.jsx(re,{"data-orientation":"vertical",...p,ref:i,style:{...p.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:c=>{const S=x(c.clientY);s==null||s(S)},onSlideMove:c=>{const S=x(c.clientY);o==null||o(S)},onSlideEnd:()=>{u.current=void 0,l==null||l()},onStepKeyDown:c=>{const g=Q[w?"from-bottom":"from-top"].includes(c.key);d==null||d({event:c,direction:g?-1:1})}})})}),re=f.forwardRef((e,t)=>{const{__scopeSlider:r,onSlideStart:n,onSlideMove:a,onSlideEnd:s,onHomeKeyDown:o,onEndKeyDown:l,onStepKeyDown:d,...p}=e,h=B(k,r);return m.jsx(V.span,{...p,ref:t,onKeyDown:C(e.onKeyDown,i=>{i.key==="Home"?(o(i),i.preventDefault()):i.key==="End"?(l(i),i.preventDefault()):G.concat(W).includes(i.key)&&(d(i),i.preventDefault())}),onPointerDown:C(e.onPointerDown,i=>{const u=i.target;u.setPointerCapture(i.pointerId),i.preventDefault(),h.thumbs.has(u)?u.focus():n(i)}),onPointerMove:C(e.onPointerMove,i=>{i.target.hasPointerCapture(i.pointerId)&&a(i)}),onPointerUp:C(e.onPointerUp,i=>{const u=i.target;u.hasPointerCapture(i.pointerId)&&(u.releasePointerCapture(i.pointerId),s(i))})})}),ne="SliderTrack",oe=f.forwardRef((e,t)=>{const{__scopeSlider:r,...n}=e,a=B(ne,r);return m.jsx(V.span,{"data-disabled":a.disabled?"":void 0,"data-orientation":a.orientation,...n,ref:t})});oe.displayName=ne;var z="SliderRange",ie=f.forwardRef((e,t)=>{const{__scopeSlider:r,...n}=e,a=B(z,r),s=te(z,r),o=f.useRef(null),l=I(t,o),d=a.values.length,p=a.values.map(u=>le(u,a.min,a.max)),h=d>1?Math.min(...p):0,i=100-Math.max(...p);return m.jsx(V.span,{"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,...n,ref:l,style:{...e.style,[s.startEdge]:h+"%",[s.endEdge]:i+"%"}})});ie.displayName=z;var L="SliderThumb",se=f.forwardRef((e,t)=>{const r=ve(e.__scopeSlider),[n,a]=f.useState(null),s=I(t,l=>a(l)),o=f.useMemo(()=>n?r().findIndex(l=>l.ref.current===n):-1,[r,n]);return m.jsx(Pe,{...e,ref:s,index:o})}),Pe=f.forwardRef((e,t)=>{const{__scopeSlider:r,index:n,name:a,...s}=e,o=B(L,r),l=te(L,r),[d,p]=f.useState(null),h=I(t,P=>p(P)),i=d?o.form||!!d.closest("form"):!0,u=pe(d),w=o.values[n],x=w===void 0?0:le(w,o.min,o.max),c=Ce(n,o.values.length),S=u==null?void 0:u[l.size],g=S?Ie(S,x,l.direction):0;return f.useEffect(()=>{if(d)return o.thumbs.add(d),()=>{o.thumbs.delete(d)}},[d,o.thumbs]),m.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${x}% + ${g}px)`},children:[m.jsx(H.ItemSlot,{scope:e.__scopeSlider,children:m.jsx(V.span,{role:"slider","aria-label":e["aria-label"]||c,"aria-valuemin":o.min,"aria-valuenow":w,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...s,ref:h,style:w===void 0?{display:"none"}:e.style,onFocus:C(e.onFocus,()=>{o.valueIndexToChangeRef.current=n})})}),i&&m.jsx(ae,{name:a??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:w},n)]})});se.displayName=L;var Ee="RadioBubbleInput",ae=f.forwardRef(({__scopeSlider:e,value:t,...r},n)=>{const a=f.useRef(null),s=I(a,n),o=Se(t);return f.useEffect(()=>{const l=a.current;if(!l)return;const d=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(d,"value").set;if(o!==t&&h){const i=new Event("input",{bubbles:!0});h.call(l,t),l.dispatchEvent(i)}},[o,t]),m.jsx(V.input,{style:{display:"none"},...r,ref:s,defaultValue:t})});ae.displayName=Ee;function De(e=[],t,r){const n=[...e];return n[r]=t,n.sort((a,s)=>a-s)}function le(e,t,r){const s=100/(r-t)*(e-t);return X(s,[0,100])}function Ce(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function Me(e,t){if(e.length===1)return 0;const r=e.map(a=>Math.abs(a-t)),n=Math.min(...r);return r.indexOf(n)}function Ie(e,t,r){const n=e/2,s=U([0,50],[0,n]);return(n-s(t)*r)*r}function ke(e){return e.slice(0,-1).map((t,r)=>e[r+1]-t)}function je(e,t){if(t>0){const r=ke(e);return Math.min(...r)>=t}return!0}function U(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function Ae(e){return(String(e).split(".")[1]||"").length}function Ke(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}var ce=Z,Ve=oe,Be=ie,Ne=se;const Te=f.forwardRef(({className:e,...t},r)=>m.jsxs(ce,{ref:r,className:ge("relative flex w-full touch-none select-none items-center",e),...t,children:[m.jsx(Ve,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:m.jsx(Be,{className:"absolute h-full bg-primary"})}),m.jsx(Ne,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Te.displayName=ce.displayName;function Ue(){const{user:e}=O();return $({queryKey:["following",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await M.from("user_follows").select("*").eq("follower_id",e.id);if(r)throw r;return t||[]},enabled:!!e})}function qe(){const{user:e}=O();return be({mutationFn:async({trackId:t,durationMs:r,source:n="feed"})=>{if(!e)throw new Error("Not authenticated");const{data:a,error:s}=await M.from("play_history").insert({user_id:e.id,track_id:t,duration_ms:r,source:n}).select().single();if(s)throw s;return a}})}function Ye(e=50){const{user:t}=O();return $({queryKey:["following-feed",t==null?void 0:t.id,e],queryFn:async()=>{if(!t)return[];const{data:r,error:n}=await M.from("user_follows").select("following_id").eq("follower_id",t.id);if(n)throw n;if(!r||r.length===0)return[];const a=r.map(c=>c.following_id),{data:s,error:o}=await M.from("play_history").select(`
          id,
          user_id,
          track_id,
          played_at,
          duration_ms,
          source
        `).in("user_id",a).order("played_at",{ascending:!1}).limit(e);if(o)throw o;if(!s||s.length===0)return[];const l=[...new Set(s.map(c=>c.track_id))],d=[...new Set(s.map(c=>c.user_id))],{data:p,error:h}=await M.from("tracks").select("id, title, artist, album, cover_url, preview_url, spotify_id, youtube_id").in("id",l);if(h)throw h;const{data:i,error:u}=await M.from("profiles").select("id, display_name, avatar_url").in("id",d);if(u)throw u;const w=new Map(p==null?void 0:p.map(c=>[c.id,c])),x=new Map(i==null?void 0:i.map(c=>[c.id,c]));return s.map(c=>({...c,track:w.get(c.track_id),profile:x.get(c.user_id)||{display_name:null,avatar_url:null}}))},enabled:!!t,refetchInterval:3e4})}export{Te as S,Ue as a,qe as b,Ye as u};
