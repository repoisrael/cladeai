import{c as ee,r as n,j as e,i as m,O as R,B as w,f as H,Q as O,P as _,m as p,S as se,a as ae,u as te,L as re,T as ne}from"./index-BI6e5KKd.js";import{A as ie,a as le,b as oe}from"./avatar-3tZON9LW.js";import{S as $,u as ce,a as de,b as ue}from"./useFollowing-B203wJuQ.js";import{f as E}from"./timeFormat-BXo_t6_Q.js";import{A as M}from"./index-_2dnxds6.js";import{g as me,o as A}from"./providers-CHelMshW.js";import{M as F}from"./music-kwvnLi8E.js";import{E as B}from"./external-link-BhkerGxg.js";import{P as Q}from"./PageLayout-DTmVMGDo.js";import{E as X,f as xe}from"./animations-5dG70dDO.js";import{U as q}from"./users-CmLvYiYM.js";import{U as he}from"./BottomNav-DrspHnQU.js";import{C as fe}from"./clock-FrRs4NZi.js";import{f as pe}from"./formatDistanceToNow-3UBXKcFR.js";import"./index-BdQq_4o_.js";import"./index-BeP1845I.js";import"./index-DLARNePZ.js";import"./useMutation-De3Hf5hC.js";import"./CladeIcon-dFdl9Xxq.js";import"./search-B6yafTIf.js";import"./en-US-wfBU2YNu.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=ee("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);function je({previewUrl:l,title:g,artist:y,coverUrl:c,isActive:d=!1,compact:r=!1,onPlay:t,onPause:o,className:j}){const a=n.useRef(null),[x,s]=n.useState(!1),[v,b]=n.useState(!1),[h,N]=n.useState(0),[f,k]=n.useState(0),[S,J]=n.useState(.7),[T,I]=n.useState(!1),[L,C]=n.useState(null);n.useEffect(()=>{!d&&x&&z()},[d]),n.useEffect(()=>()=>{a.current&&(a.current.pause(),a.current.src="")},[]);const K=n.useCallback(async()=>{if(!(!a.current||!l)){b(!0),C(null);try{await a.current.play(),s(!0),t==null||t()}catch(i){console.error("Playback failed:",i),C("Unable to play preview")}finally{b(!1)}}},[l,t]),z=n.useCallback(()=>{a.current&&(a.current.pause(),s(!1),o==null||o())},[o]),U=()=>{x?z():K()},V=()=>{if(!a.current)return;const i=a.current.currentTime,u=a.current.duration;N(u>0?i/u*100:0)},D=()=>{a.current&&k(a.current.duration)},P=()=>{s(!1),N(0),o==null||o()},W=i=>{if(!a.current)return;const u=i[0]/100*a.current.duration;a.current.currentTime=u,N(i[0])},Y=i=>{const u=i[0]/100;J(u),a.current&&(a.current.volume=u),I(u===0)},Z=()=>{a.current&&(T?(a.current.volume=S,I(!1)):(a.current.volume=0,I(!0)))};return l?r?e.jsxs("div",{className:m("flex items-center gap-2",j),children:[e.jsx("audio",{ref:a,src:l,preload:"none",onTimeUpdate:V,onLoadedMetadata:D,onEnded:P,onError:()=>C("Failed to load audio")}),e.jsx(w,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full bg-primary/10 hover:bg-primary/20",onClick:U,disabled:v||!!L,children:v?e.jsx(H,{className:"w-5 h-5 animate-spin"}):x?e.jsx(O,{className:"w-5 h-5"}):e.jsx(_,{className:"w-5 h-5 ml-0.5"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"h-1 bg-muted rounded-full overflow-hidden",children:e.jsx(p.div,{className:"h-full bg-primary",style:{width:`${h}%`},transition:{duration:.1}})})}),e.jsxs("span",{className:"text-xs text-muted-foreground tabular-nums",children:[E(h/100*f)," / ",E(f)]})]}):e.jsxs("div",{className:m("rounded-xl bg-card/50 backdrop-blur-sm p-4 space-y-3",j),children:[e.jsx("audio",{ref:a,src:l,preload:"none",onTimeUpdate:V,onLoadedMetadata:D,onEnded:P,onError:()=>C("Failed to load audio")}),e.jsxs("div",{className:"flex items-center gap-3",children:[c&&e.jsxs("div",{className:"relative w-12 h-12 rounded-lg overflow-hidden flex-shrink-0",children:[e.jsx("img",{src:c,alt:"",className:"w-full h-full object-cover"}),e.jsx(M,{children:x&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/40 flex items-center justify-center",children:e.jsx("div",{className:"flex gap-0.5",children:[0,1,2].map(i=>e.jsx(p.div,{className:"w-1 bg-white rounded-full",animate:{height:[8,16,8]},transition:{duration:.5,repeat:1/0,delay:i*.1}},i))})})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:g}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:y})]}),e.jsx(w,{variant:"default",size:"icon",className:"h-12 w-12 rounded-full flex-shrink-0",onClick:U,disabled:v||!!L,children:v?e.jsx(H,{className:"w-6 h-6 animate-spin"}):x?e.jsx(O,{className:"w-6 h-6"}):e.jsx(_,{className:"w-6 h-6 ml-0.5"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx($,{value:[h],onValueChange:W,max:100,step:.1,className:"cursor-pointer"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground tabular-nums",children:[e.jsx("span",{children:E(h/100*f)}),e.jsx("span",{children:E(f)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:Z,children:T?e.jsx(R,{className:"w-4 h-4"}):e.jsx(se,{className:"w-4 h-4"})}),e.jsx($,{value:[T?0:S*100],onValueChange:Y,max:100,step:1,className:"w-24"})]}),L&&e.jsx("p",{className:"text-sm text-destructive",children:L})]}):e.jsxs("div",{className:m("flex items-center gap-2 text-muted-foreground text-sm",j),children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:"No preview available"})]})}const G={spotify:"ðŸŽµ",youtube:"â–¶ï¸",apple_music:"ðŸŽ",deezer:"ðŸŽ§",soundcloud:"â˜ï¸",amazon_music:"ðŸ“¦"};function ve({track:l,defaultProvider:g,onSetDefault:y,compact:c=!1,className:d}){const r=me(l);return r.length===0?e.jsxs("div",{className:m("text-muted-foreground text-sm flex items-center gap-2",d),children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:"No streaming links available"})]}):c?e.jsx("div",{className:m("flex items-center gap-2 flex-wrap",d),children:r.map(t=>e.jsxs(p.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>A(t,!1),className:m("inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-colors","hover:opacity-90",g===t.provider?"ring-2 ring-primary ring-offset-2 ring-offset-background":""),style:{backgroundColor:`${t.color}20`,color:t.color},children:[e.jsx("span",{className:"text-base",children:G[t.provider]||"ðŸŽ¶"}),e.jsx("span",{children:t.name}),e.jsx(B,{className:"w-3 h-3 opacity-60"})]},t.provider))}):e.jsxs("div",{className:m("space-y-2",d),children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Stream on"]}),e.jsx("div",{className:"grid gap-2",children:r.map(t=>e.jsxs(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:m("flex items-center gap-3 p-3 rounded-xl transition-all","bg-muted/50 hover:bg-muted"),children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-xl",style:{backgroundColor:`${t.color}20`},children:G[t.provider]||"ðŸŽ¶"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground",children:t.name}),g===t.provider&&e.jsx("span",{className:"text-xs text-primary",children:"Default"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.appUrl&&e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>A(t,!0),title:"Open in app",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsxs(w,{variant:"secondary",size:"sm",className:"gap-1",onClick:()=>A(t,!1),children:[e.jsx(B,{className:"w-3 h-3"}),"Open"]})]})]},t.provider))})]})}function He(){const{user:l,loading:g}=ae(),y=te(),{data:c,isLoading:d}=ce(),{data:r,isLoading:t}=de(),o=ue(),[j,a]=n.useState(null);if(g)return e.jsx(re,{fullScreen:!0});if(!l)return e.jsx(Q,{title:"Following",fixedHeader:!0,children:e.jsx(X,{icon:q,title:"Sign in to see what people are listening to",description:"Follow other music lovers and discover new tracks through their listening activity.",actionLabel:"Sign in",actionIcon:he,onAction:()=>y("/auth")})});const x=d||t;return e.jsx(Q,{fixedHeader:!0,headerContent:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-lg font-bold gradient-text",children:"Following"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[(r==null?void 0:r.length)||0," following"]})]}),children:e.jsx("div",{className:"space-y-4",children:x?e.jsx("div",{className:"space-y-4 pt-4",children:e.jsx(ne,{count:5})}):!c||c.length===0?e.jsx(X,{icon:F,title:"No activity yet",description:r&&r.length>0?"The people you follow haven't played any tracks recently.":"Follow some music lovers to see what they're listening to!",actionLabel:!r||r.length===0?"Find people to follow":void 0,actionIcon:q,onAction:!r||r.length===0?()=>y("/search"):void 0}):e.jsx(M,{children:c.map((s,v)=>{var b,h,N,f,k;return e.jsxs(p.div,{variants:xe,initial:"initial",animate:"animate",transition:{delay:v*.05},className:"rounded-xl bg-card/50 backdrop-blur-sm border border-border/50 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-border/30",children:[e.jsxs(ie,{className:"w-10 h-10",children:[e.jsx(le,{src:((b=s.profile)==null?void 0:b.avatar_url)||void 0}),e.jsx(oe,{children:((f=(N=(h=s.profile)==null?void 0:h.display_name)==null?void 0:N[0])==null?void 0:f.toUpperCase())||"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:((k=s.profile)==null?void 0:k.display_name)||"Anonymous"}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(fe,{className:"w-3 h-3"}),e.jsx("span",{children:pe(new Date(s.played_at),{addSuffix:!0})})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(_,{className:"w-3 h-3"}),e.jsx("span",{children:"Played"})]})]}),s.track&&e.jsxs("div",{className:"p-4 cursor-pointer hover:bg-muted/30 transition-colors",onClick:()=>a(j===s.id?null:s.id),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden flex-shrink-0 bg-muted",children:s.track.cover_url?e.jsx("img",{src:s.track.cover_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(F,{className:"w-8 h-8 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-foreground truncate",children:s.track.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.track.artist}),s.track.album&&e.jsx("p",{className:"text-xs text-muted-foreground/70 truncate",children:s.track.album})]}),e.jsx(w,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full",onClick:S=>{S.stopPropagation(),o.mutate({trackId:s.track_id,source:"following-feed"})},children:e.jsx(_,{className:"w-5 h-5"})})]}),e.jsx(M,{children:j===s.id&&e.jsx(p.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"pt-4 space-y-4 border-t border-border/30 mt-4",children:[s.track.preview_url&&e.jsx(je,{previewUrl:s.track.preview_url,title:s.track.title,artist:s.track.artist,coverUrl:s.track.cover_url,compact:!0}),e.jsx(ve,{track:{spotifyId:s.track.spotify_id||void 0,youtubeId:s.track.youtube_id||void 0},compact:!0})]})})})]})]},s.id)})})})})}export{He as default};
