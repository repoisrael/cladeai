import{j as e,m as v,a as E,u as L,r,B as d,X as Y,b as R,C as H,d as J}from"./index-BI6e5KKd.js";import{T as W}from"./TrackCard-DQCONBaN.js";import{u as G,S as K}from"./useTracks-BbX10Uyx.js";import{B as C}from"./BottomNav-DrspHnQU.js";import{A as z}from"./index-_2dnxds6.js";import{S as V}from"./sparkles-BmjmEley.js";import{U as $}from"./TrackComments-CtkKmXdi.js";import{R as I}from"./ResponsiveLayout-Dqs3xQqw.js";import{C as q}from"./circle-alert-DsRaiGXR.js";import{L as O}from"./log-in-CYajORN2.js";import"./ChordBadge-CpdYEsQY.js";import"./rotate-ccw-BU-JZZl7.js";import"./music-kwvnLi8E.js";import"./switch-jmWW_fB_.js";import"./index-B9TUITdl.js";import"./Combination-CjLqDtlN.js";import"./index-DLARNePZ.js";import"./avatar-3tZON9LW.js";import"./scroll-area-0UcrOe2s.js";import"./index-BeP1845I.js";import"./index-BdQq_4o_.js";import"./useFollowing-B203wJuQ.js";import"./useMutation-De3Hf5hC.js";import"./label-C_oASRYj.js";import"./users-CmLvYiYM.js";import"./map-pin-C1964AYS.js";import"./radio-BSle07YB.js";import"./formatDistanceToNow-3UBXKcFR.js";import"./en-US-wfBU2YNu.js";import"./share-2-DOXsRuWz.js";import"./check-ChXx28qk.js";import"./twitter-DU2wPq_q.js";import"./send-CyFpBjwX.js";import"./QuickStreamButtons-Bv0D4LiA.js";import"./providers-CHelMshW.js";import"./youtubeSearchService-C_W3FhdG.js";import"./timeFormat-BXo_t6_Q.js";import"./music-2-B_Dssdoi.js";import"./CladeIcon-dFdl9Xxq.js";import"./heart-CutDkfLo.js";import"./waves-0CI_rh8K.js";import"./bookmark-DSJVki65.js";import"./search-B6yafTIf.js";import"./seedTracks-B22TRa5Y.js";import"./spotifySearchService-mwupN4jQ.js";import"./textarea-yoZM0u9c.js";import"./badge-BU1YdHVn.js";import"./index-D_raKJPF.js";import"./chevron-right-CWmwnNKF.js";import"./trash-2-xVWoPPMJ.js";function Q(){return e.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 z-0",children:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-secondary to-background animate-shimmer"})}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col justify-end p-6 pb-8 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},className:"h-8 w-3/4 bg-muted/50 rounded-lg animate-shimmer"}),e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05},className:"h-6 w-1/2 bg-muted/50 rounded-lg animate-shimmer"})]}),e.jsx("div",{className:"h-12 w-36 bg-muted/50 rounded-xl animate-shimmer"}),e.jsxs("div",{className:"glass-strong rounded-2xl p-4 space-y-3",children:[e.jsx("div",{className:"h-4 w-24 bg-muted/50 rounded animate-shimmer"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(i=>e.jsx("div",{className:"h-8 w-12 bg-muted/50 rounded-lg animate-shimmer",style:{animationDelay:`${i*100}ms`}},i))})]}),e.jsx("div",{className:"flex items-center justify-between pt-4",children:[1,2,3,4,5].map(i=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 bg-muted/50 rounded-full animate-shimmer"}),e.jsx("div",{className:"w-10 h-3 bg-muted/50 rounded animate-shimmer"})]},i))})]})]})}function Z(){const{guestMode:i,user:b}=E(),j=L(),[x,N]=r.useState(()=>{const a=localStorage.getItem("clade_guest_banner_dismissed");if(!a)return!1;const u=parseInt(a,10),k=24*60*60*1e3;return Date.now()-u<k}),w=i&&!b&&!x,y=()=>{N(!0),localStorage.setItem("clade_guest_banner_dismissed",Date.now().toString())},n=()=>{j("/auth")};return e.jsx(z,{children:w&&e.jsxs(v.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",damping:20,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 safe-bottom",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsx("div",{className:"absolute inset-0 bg-background/95 backdrop-blur-xl border-t border-border/50"}),e.jsxs("div",{className:"relative max-w-7xl mx-auto px-4 py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-[#00F5FF] to-[#FF00FF]",children:e.jsx(V,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-0.5",children:"Join the Conversation"}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:"Sign up to comment, like, and connect with music lovers"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(d,{size:"sm",onClick:n,className:"bg-gradient-to-r from-[#00F5FF] to-[#FF00FF] hover:opacity-90 transition-opacity shadow-lg shadow-[#00F5FF]/20",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign Up"}),e.jsx("span",{className:"sm:hidden",children:"Join"})]}),e.jsx(d,{size:"sm",variant:"ghost",onClick:y,className:"text-muted-foreground hover:text-foreground",children:e.jsx(Y,{className:"w-4 h-4"})})]})]})]})})}function qe(){const{user:i,loading:b}=E(),j=L(),{data:x,isLoading:N,error:w}=G(50),y=(x==null?void 0:x.tracks)??[],n=(()=>{const s=new Set;return y.filter(t=>{const o=t.spotify_id||t.id;return s.has(o)?!1:(s.add(o),!0)})})(),[a,u]=r.useState(0),[k,D]=r.useState(new Map),T=r.useRef(null),[A,S]=r.useState(!i),{openPlayer:M}=R();r.useEffect(()=>{i&&S(!1)},[i]);const P=s=>{var o;if(!i){S(!0);return}const t=(o=n[a])==null?void 0:o.id;t&&(D(l=>{const f=new Map(l),c=new Set(l.get(t)||[]);return c.has(s)?c.delete(s):c.add(s),f.set(t,c),f}),s==="skip"&&a<n.length-1&&u(l=>l+1))},h=r.useCallback(()=>{a<n.length-1&&u(s=>s+1)},[a,n.length]),p=r.useCallback(()=>{a>0&&u(s=>s-1)},[a]);if(r.useEffect(()=>{const s=t=>{t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||(t.key==="ArrowDown"||t.key==="j"?h():(t.key==="ArrowUp"||t.key==="k")&&p())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[h,p]),r.useEffect(()=>{const s=T.current;if(!s)return;let t=0,o=0,l=0;const f=g=>{t=g.touches[0].clientY,o=g.touches[0].clientX,l=Date.now()},c=g=>{const _=g.changedTouches[0].clientY,B=g.changedTouches[0].clientX,F=t-_,U=Math.abs(o-B),X=Date.now()-l;Math.abs(F)>50&&Math.abs(F)>U&&X<500&&(F>0?h():p())};return s.addEventListener("touchstart",f,{passive:!0}),s.addEventListener("touchend",c,{passive:!0}),()=>{s.removeEventListener("touchstart",f),s.removeEventListener("touchend",c)}},[h,p]),b||N)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Q,{}),e.jsx(C,{})]});if(w)return e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsxs("div",{className:"text-center p-6",children:[e.jsx(q,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Failed to load tracks"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try again later"})]}),e.jsx(C,{})]});const m=n[a];return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col touch-pan-y",ref:T,"data-feed":!0,children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-40 glass-strong safe-top",children:e.jsx(I,{maxWidth:"full",children:e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("h1",{className:"text-lg lg:text-xl font-bold gradient-text",children:"HarmonyFeed"}),e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsxs("span",{className:"text-xs lg:text-sm text-muted-foreground flex items-center gap-1",children:[a+1," / ",n.length]}),!i&&e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>j("/auth"),className:"gap-1.5",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign in"})]})]})]})})}),A&&!i&&e.jsx("div",{className:"pt-16 px-4",children:e.jsx("div",{className:"mx-auto max-w-3xl rounded-xl border border-border/60 bg-background/70 px-4 py-3 text-sm text-muted-foreground shadow-lg backdrop-blur",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Youâ€™re exploring in guest mode."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sign in to like, comment, follow, and save tracks. Playback and browsing stay open."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{size:"sm",onClick:()=>j("/auth"),children:"Sign in"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>S(!1),children:"Maybe later"})]})]})})}),e.jsxs("div",{className:"hidden md:flex fixed left-4 top-1/2 -translate-y-1/2 z-30 flex-col gap-2",children:[e.jsx(d,{variant:"outline",size:"icon",className:"glass",onClick:p,disabled:a===0,children:e.jsx(H,{className:"w-5 h-5"})}),e.jsx(d,{variant:"outline",size:"icon",className:"glass",onClick:h,disabled:a===n.length-1,children:e.jsx(J,{className:"w-5 h-5"})})]}),e.jsx("main",{className:"flex-1 pt-16 pb-24",children:e.jsx(I,{maxWidth:"full",className:"py-6",children:e.jsx("div",{className:"h-[calc(100vh-12rem)] max-w-lg mx-auto lg:max-w-2xl",children:e.jsx(z,{mode:"wait",children:m&&e.jsx(v.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.3},className:"h-full",children:e.jsx(W,{track:m,isActive:!0,onInteraction:P,interactions:k.get(m.id)||new Set,onPipModeActivate:(s,t)=>{s&&M({canonicalTrackId:m.id,provider:"youtube",providerTrackId:s,autoplay:!0,context:"feed",title:t,artist:m.artist})}})},m.id)})})})}),n[a]&&e.jsx(K,{roomId:"global",maxVisible:3,scrollSpeed:4e3}),e.jsx(Z,{}),e.jsx(C,{})]})}export{qe as default};
