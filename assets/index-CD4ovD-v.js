import{r as s,aG as D,j as w,ah as H,ao as W,aH as G,aI as K,ap as U,aJ as B}from"./index-Cs3svTVr.js";function L(e,r){if(typeof e=="function")return e(r);e!=null&&(e.current=r)}function F(...e){return r=>{let t=!1;const o=e.map(c=>{const f=L(c,r);return!t&&typeof f=="function"&&(t=!0),f});if(t)return()=>{for(let c=0;c<o.length;c++){const f=o[c];typeof f=="function"?f():L(e[c],null)}}}}function J(...e){return s.useCallback(F(...e),e)}class T extends s.Component{getSnapshotBeforeUpdate(r){const t=this.props.childRef.current;if(t&&r.isPresent&&!this.props.isPresent){const o=t.offsetParent,c=H(o)&&o.offsetWidth||0,f=H(o)&&o.offsetHeight||0,n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft,n.right=c-n.width-n.left,n.bottom=f-n.height-n.top}return null}componentDidUpdate(){}render(){return this.props.children}}function V({children:e,isPresent:r,anchorX:t,anchorY:o,root:c}){var m;const f=s.useId(),n=s.useRef(null),g=s.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:y}=s.useContext(D),P=((m=e.props)==null?void 0:m.ref)??(e==null?void 0:e.ref),a=J(n,P);return s.useInsertionEffect(()=>{const{width:u,height:p,top:h,left:C,right:x,bottom:M}=g.current;if(r||!n.current||!u||!p)return;const j=t==="left"?`left: ${C}`:`right: ${x}`,b=o==="bottom"?`bottom: ${M}`:`top: ${h}`;n.current.dataset.motionPopId=f;const l=document.createElement("style");y&&(l.nonce=y);const R=c??document.head;return R.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${f}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${p}px !important;
            ${j}px !important;
            ${b}px !important;
          }
        `),()=>{R.contains(l)&&R.removeChild(l)}},[r]),w.jsx(T,{isPresent:r,childRef:n,sizeRef:g,children:s.cloneElement(e,{ref:a})})}const X=({children:e,initial:r,isPresent:t,onExitComplete:o,custom:c,presenceAffectsLayout:f,mode:n,anchorX:g,anchorY:y,root:P})=>{const a=W(Y),m=s.useId();let u=!0,p=s.useMemo(()=>(u=!1,{id:m,initial:r,isPresent:t,custom:c,onExitComplete:h=>{a.set(h,!0);for(const C of a.values())if(!C)return;o&&o()},register:h=>(a.set(h,!1),()=>a.delete(h))}),[t,a,o]);return f&&u&&(p={...p}),s.useMemo(()=>{a.forEach((h,C)=>a.set(C,!1))},[t]),s.useEffect(()=>{!t&&!a.size&&o&&o()},[t]),n==="popLayout"&&(e=w.jsx(V,{isPresent:t,anchorX:g,anchorY:y,root:P,children:e})),w.jsx(G.Provider,{value:p,children:e})};function Y(){return new Map}const $=e=>e.key||"";function S(e){const r=[];return s.Children.forEach(e,t=>{s.isValidElement(t)&&r.push(t)}),r}const q=({children:e,custom:r,initial:t=!0,onExitComplete:o,presenceAffectsLayout:c=!0,mode:f="sync",propagate:n=!1,anchorX:g="left",anchorY:y="top",root:P})=>{const[a,m]=K(n),u=s.useMemo(()=>S(e),[e]),p=n&&!a?[]:u.map($),h=s.useRef(!0),C=s.useRef(u),x=W(()=>new Map),M=s.useRef(new Set),[j,b]=s.useState(u),[l,R]=s.useState(u);U(()=>{h.current=!1,C.current=u;for(let d=0;d<l.length;d++){const i=$(l[d]);p.includes(i)?(x.delete(i),M.current.delete(i)):x.get(i)!==!0&&x.set(i,!1)}},[l,p.length,p.join("-")]);const I=[];if(u!==j){let d=[...u];for(let i=0;i<l.length;i++){const E=l[i],v=$(E);p.includes(v)||(d.splice(i,0,E),I.push(E))}return f==="wait"&&I.length&&(d=I),R(S(d)),b(u),null}const{forceRender:k}=s.useContext(B);return w.jsx(w.Fragment,{children:l.map(d=>{const i=$(d),E=n&&!a?!1:u===l||p.includes(i),v=()=>{if(M.current.has(i))return;if(M.current.add(i),x.has(i))x.set(i,!0);else return;let z=!0;x.forEach(A=>{A||(z=!1)}),z&&(k==null||k(),R(C.current),n&&(m==null||m()),o&&o())};return w.jsx(X,{isPresent:E,initial:!h.current||t?void 0:!1,custom:r,presenceAffectsLayout:c,mode:f,root:P,onExitComplete:E?void 0:v,anchorX:g,anchorY:y,children:d},i)})})};export{q as A};
