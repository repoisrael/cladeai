import{c as ce,u as de,a as me,r as n,R as ue,j as e,B as f,m as y,X as E,f as he}from"./index-DU9s-_hK.js";import{B as xe}from"./BottomNav-D9xoeS-Z.js";import{C as J}from"./ChordBadge-ajIAV6TF.js";import{I as fe}from"./input-EfPj2VDE.js";import{B as g}from"./badge-CHNwB-Fr.js";import{s as N,p as pe}from"./seedTracks-B6rAh97_.js";import{u as ye,n as $}from"./useSpotifyUser-Dg4IwZOU.js";import{s as X}from"./spotifySearchService-C_4yC3RV.js";import{s as ge,Q as R}from"./QuickStreamButtons-DhdZbvL-.js";import{R as Z}from"./ResponsiveLayout-BI8R-vpR.js";import{M as W}from"./music-DK4cbTSn.js";import{T as K}from"./trending-up-BqFRIB0r.js";import{S as ee}from"./search-B_a3db6T.js";import{A as je}from"./index-DAnwWV-y.js";import{Z as se}from"./zap-C_L46laq.js";import{H as te}from"./heart-DRNjfxZp.js";import{S as Ne}from"./sparkles-BRpeJ0hB.js";import{C as ve}from"./clock-Cf8LJVkj.js";import{A as be}from"./arrow-right-BIAsIGYf.js";import{E as we}from"./external-link-BxlrdRmb.js";import"./providers-CHelMshW.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ce("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),P="clade_search_history",Ce=20;function T(){try{const d=localStorage.getItem(P);return d?JSON.parse(d).sort((h,a)=>a.timestamp-h.timestamp):[]}catch(d){return console.error("Error loading search history:",d),[]}}function _e(d){try{const c=T();if(c.slice(0,5).some(o=>o.query.toLowerCase()===d.query.toLowerCase()&&o.type===d.type))return;const v=[{...d,id:`${Date.now()}-${Math.random()}`,timestamp:Date.now()},...c].slice(0,Ce);localStorage.setItem(P,JSON.stringify(v))}catch(c){console.error("Error saving search history:",c)}}function Ie(d){try{const h=T().filter(a=>a.id!==d);localStorage.setItem(P,JSON.stringify(h))}catch(c){console.error("Error removing from search history:",c)}}function Je(){const d=de(),{user:c}=me(),{data:h}=ye(),[a,v]=n.useState(""),[o,B]=n.useState("song"),[p,L]=n.useState([]),[re,k]=n.useState(0),[Y,b]=n.useState(0),[ae,H]=n.useState([]),[w,z]=n.useState(!1),[D,M]=n.useState([]),[x,S]=n.useState([]),[m,F]=n.useState("all"),[u,A]=n.useState("all"),[O,ie]=n.useState(!1);n.useEffect(()=>{M(T())},[]),n.useEffect(()=>{console.log("ðŸ” SearchPage mounted"),console.log("ðŸ“Š seedTracks count:",N.length),console.log("ðŸ“¦ First track:",N[0])},[]),n.useEffect(()=>{if(o!=="song"||!a.trim()||!c||!h){L([]),k(0),b(0);return}b(0);const s=setTimeout(async()=>{z(!0);try{const{tracks:t,total:r}=await X(c.id,a,50,0);L(t),k(r),b(t.length)}catch(t){console.error("Spotify search error:",t),L([]),k(0),b(0)}finally{z(!1)}},300);return()=>clearTimeout(s)},[a,o,c,h]);const le=ue.useCallback(async()=>{if(c){z(!0);try{const{tracks:s,total:t}=await X(c.id,a,50,Y);L(r=>[...r,...s]),k(t),b(r=>r+s.length)}catch(s){console.error("Spotify load-more error:",s)}finally{z(!1)}}},[c,a,Y]);n.useEffect(()=>{let s=!1;if(o!=="song"||!a.trim()||h){H([]);return}const t=setTimeout(async()=>{try{const r=await ge(a,"");if(s)return;const i=r.map(l=>({id:`youtube:${l.videoId}`,title:l.title,artist:l.channel,youtube_id:l.videoId,provider:"youtube"}));H(i)}catch(r){console.error("YouTube search error:",r),H([])}},300);return()=>{s=!0,clearTimeout(t)}},[a,o,h]);const j=n.useMemo(()=>{let s=[];if(o==="song"){const t=a.toLowerCase();s=N.filter(r=>{var i,l,C,_,I;return!a.trim()||((i=r.title)==null?void 0:i.toLowerCase().includes(t))||((l=r.artist)==null?void 0:l.toLowerCase().includes(t))||((C=r.album)==null?void 0:C.toLowerCase().includes(t))||((_=r.genre)==null?void 0:_.toLowerCase().includes(t))||((I=r.genre_description)==null?void 0:I.toLowerCase().includes(t))})}else{const t=a.toUpperCase().split(/[-â€“â€”,\s]+/).map(r=>r.trim()).filter(Boolean);s=N.filter(r=>{if(!r.progression_roman)return!1;const i=r.progression_roman.map(l=>l.toUpperCase());return t.length===0||t.every(l=>i.includes(l)||i.includes(l.toLowerCase()))})}if(x.length>0&&(s=s.filter(t=>{const r=[t.genre,...t.genres||[]].filter(Boolean).map(i=>i==null?void 0:i.toLowerCase());return x.some(i=>r.some(l=>l==null?void 0:l.includes(i.toLowerCase())))})),m!=="all"&&(s=s.filter(t=>typeof t.energy!="number"?!1:m==="high"?t.energy>.7:m==="medium"?t.energy>=.4&&t.energy<=.7:m==="low"?t.energy<.4:!0)),u!=="all"&&(s=s.filter(t=>typeof t.valence!="number"?!1:u==="happy"?t.valence>.6:u==="sad"?t.valence<.4:u==="neutral"?t.valence>=.4&&t.valence<=.6:!0)),a.trim()&&o==="song"){const t=a.toLowerCase();return s.sort((r,i)=>{var q,Q,G,U;const l=((q=r.title)==null?void 0:q.toLowerCase())||"",C=((Q=i.title)==null?void 0:Q.toLowerCase())||"",_=((G=r.artist)==null?void 0:G.toLowerCase())||"",I=((U=i.artist)==null?void 0:U.toLowerCase())||"";return l.startsWith(t)&&!C.startsWith(t)?-1:!l.startsWith(t)&&C.startsWith(t)?1:_.startsWith(t)&&!I.startsWith(t)?-1:!_.startsWith(t)&&I.startsWith(t)?1:0})}return s},[a,o,x,m,u]),V=s=>{a.trim()&&(_e({query:a.trim(),type:o,track:o==="song"?s:void 0}),M(T()));const t=s.id||s.spotify_id||s.external_id;t&&$(d,t)},oe=(s,t)=>{t.stopPropagation(),Ie(s),M(T())},ne=s=>{s.track?$(d,s.track.id):(v(s.query),B(s.type))};return e.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 glass-strong safe-top",children:e.jsx(Z,{maxWidth:"full",children:e.jsxs("div",{className:"py-4 space-y-3",children:[e.jsx("h1",{className:"text-xl lg:text-2xl font-bold",children:"Search"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:o==="song"?"default":"outline",size:"sm",onClick:()=>B("song"),className:"flex-1",children:[e.jsx(W,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Song / Artist"}),e.jsx("span",{className:"sm:hidden",children:"Song"})]}),e.jsxs(f,{variant:o==="chord"?"default":"outline",size:"sm",onClick:()=>B("chord"),className:"flex-1",children:[e.jsx(K,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Chord Progression"}),e.jsx("span",{className:"sm:hidden",children:"Chords"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(fe,{placeholder:o==="song"?"Search songs or artists...":"e.g., vi-IV-I-V or I-V-vi-IV",value:a,onChange:s=>v(s.target.value),className:"pl-10 bg-muted/50",autoFocus:!0})]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>ie(!O),className:"w-full",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Filters",(x.length>0||m!=="all"||u!=="all")&&e.jsx(g,{variant:"secondary",className:"ml-2",children:x.length+(m!=="all"?1:0)+(u!=="all"?1:0)})]}),e.jsx(je,{children:O&&e.jsx(y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Genre",x.length>0&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>S([]),className:"h-6 text-xs",children:"Clear"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["pop","rock","hip hop","r&b","jazz","funk","soul","blues","country","disco","synthpop","reggae","punk"].map(s=>e.jsx(g,{variant:x.includes(s)?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{S(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},children:s},s))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Energy"]}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"All"},{value:"high",label:"High Energy"},{value:"medium",label:"Medium"},{value:"low",label:"Chill"}].map(s=>e.jsx(g,{variant:m===s.value?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>F(s.value),children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Mood"]}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"All",icon:Ne},{value:"happy",label:"Happy",icon:"ðŸ˜Š"},{value:"neutral",label:"Neutral",icon:"ðŸ˜"},{value:"sad",label:"Melancholic",icon:"ðŸ˜¢"}].map(s=>e.jsxs(g,{variant:u===s.value?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>A(s.value),children:[typeof s.icon=="string"?s.icon:""," ",s.label]},s.value))})]})]})})})]})})}),e.jsx("main",{className:"py-4 space-y-6",children:e.jsxs(Z,{maxWidth:"full",children:[!a&&D.length>0&&e.jsxs("section",{children:[e.jsxs("h2",{className:"text-sm font-semibold text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Recent Searches"]}),e.jsx("div",{className:"space-y-2",children:D.slice(0,10).map((s,t)=>e.jsx(y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.03},onClick:()=>ne(s),className:"p-3 glass rounded-lg cursor-pointer hover:bg-muted/50 transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted/50 flex items-center justify-center flex-shrink-0",children:s.type==="song"?e.jsx(W,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(K,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("div",{className:"flex-1 min-w-0",children:s.track?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium truncate",children:s.track.title}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s.track.artist})]}):e.jsx("div",{className:"font-medium",children:s.query})}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",onClick:r=>oe(s.id,r),children:e.jsx(E,{className:"w-4 h-4"})})]})},s.id))})]}),o==="chord"&&!a&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Popular Progressions"}),e.jsx("div",{className:"space-y-2",children:pe.slice(0,5).map((s,t)=>e.jsxs(y.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.05},onClick:()=>v(s.progression.join("-")),className:"w-full p-4 glass rounded-xl text-left group hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx(be,{className:"w-4 h-4 text-muted-foreground group-hover:text-foreground transition-colors"})]}),e.jsx("div",{className:"flex gap-1.5 flex-wrap",children:s.progression.map((r,i)=>e.jsx(J,{chord:r,size:"sm"},i))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:s.description})]},s.name))})]}),a&&p.length===0&&j.length===0&&!w&&e.jsx("section",{children:e.jsxs("div",{className:"glass rounded-2xl p-8 text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mx-auto",children:e.jsx(ee,{className:"w-10 h-10 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold mb-2",children:['No results for "',a,'"']}),x.length>0||m!=="all"||u!=="all"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"No tracks match your search with the selected filters"}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{S([]),F("all"),A("all")},children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:["Searched ",N.length," tracks with chord progressions"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Try searching for artist names like "weeknd" or chord progressions like "vi-IV-I-V"'})]})]}),!h&&e.jsxs("div",{className:"glass-strong rounded-xl p-6 space-y-3 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-[#1DB954]",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Unlock unlimited search"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect Spotify to search millions of songs beyond the local database"}),e.jsx(f,{onClick:()=>d("/profile"),className:"w-full bg-[#1DB954] hover:bg-[#1ed760] text-white",size:"lg",children:"Connect Spotify"})]})]})}),(p.length>0||j.length>0)&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2 flex-wrap",children:["Results (",p.length+j.length,")",w&&e.jsx(he,{className:"w-3 h-3 animate-spin"}),p.length>0&&e.jsx("span",{className:"text-[#1DB954] text-xs",children:"via Spotify"}),j.length>0&&e.jsx("span",{className:"text-xs text-purple-500",children:"via Local DB"})]}),(x.length>0||m!=="all"||u!=="all")&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>{S([]),F("all"),A("all")},className:"h-7 text-xs",children:"Clear Filters"})]}),(x.length>0||m!=="all"||u!=="all")&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[x.map(s=>e.jsxs(g,{variant:"secondary",className:"text-xs",children:[s,e.jsx(E,{className:"w-3 h-3 ml-1 cursor-pointer",onClick:()=>S(t=>t.filter(r=>r!==s))})]},s)),m!=="all"&&e.jsxs(g,{variant:"secondary",className:"text-xs",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),m," energy",e.jsx(E,{className:"w-3 h-3 ml-1 cursor-pointer",onClick:()=>F("all")})]}),u!=="all"&&e.jsxs(g,{variant:"secondary",className:"text-xs",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),u,e.jsx(E,{className:"w-3 h-3 ml-1 cursor-pointer",onClick:()=>A("all")})]})]}),e.jsxs("div",{className:"space-y-2",children:[p.map((s,t)=>e.jsx(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>V(s),children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist}),s.album&&e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:s.album})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(R,{track:{spotifyId:s.spotify_id??s.id,youtubeId:s.youtube_id,urlSpotifyWeb:s.external_url},canonicalTrackId:s.id,trackTitle:s.title,trackArtist:s.artist,size:"md"})})]})},s.id)),p.length<re&&e.jsx("div",{className:"flex justify-center py-2",children:e.jsx(f,{variant:"outline",size:"sm",onClick:le,disabled:w,children:w?"Loadingâ€¦":"Load more Spotify results"})}),ae.map((s,t)=>e.jsx(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>V(s),children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(R,{track:{youtubeId:s.youtube_id,spotifyId:s.spotify_id,urlYoutube:s.url_youtube},canonicalTrackId:s.id,trackTitle:s.title,trackArtist:s.artist,size:"md"})})]})},s.id)),j.map((s,t)=>e.jsx(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl",children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist}),s.progression_roman&&e.jsx("div",{className:"flex gap-1 mt-2 flex-wrap",children:s.progression_roman.map((r,i)=>e.jsx(J,{chord:r,size:"sm",keySignature:s.detected_key},i))})]}),e.jsx("div",{className:"flex flex-col gap-1",children:e.jsx(R,{track:{spotifyId:s.spotify_id,youtubeId:s.youtube_id,urlYoutube:s.url_youtube,urlSpotifyWeb:s.url_spotify_web},canonicalTrackId:s.id,trackTitle:s.title,trackArtist:s.artist,size:"md",className:"justify-end"})})]})},s.id))]})]}),a&&p.length===0&&j.length===0&&!w&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("p",{className:"text-muted-foreground",children:['No results found for "',a,'"']}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:!h&&c?"Connect Spotify for full catalog access":"Try a different search term"})]}),!a&&o==="song"&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Trending Tracks"}),e.jsx("div",{className:"space-y-2",children:N.slice(0,10).map((s,t)=>e.jsx(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-8 text-lg font-bold text-muted-foreground",children:t+1}),s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist})]}),e.jsx(R,{track:{spotifyId:s.spotify_id,youtubeId:s.youtube_id,urlYoutube:s.url_youtube,urlSpotifyWeb:s.url_spotify_web},canonicalTrackId:s.id,trackTitle:s.title,trackArtist:s.artist,size:"sm"})]})},s.id))})]})]})}),e.jsx(xe,{})]})}export{Je as default};
