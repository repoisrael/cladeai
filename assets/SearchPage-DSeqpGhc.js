import{c as de,u as me,a as ue,r as o,j as e,B as h,m as g,X as B,f as he,P as M}from"./index-BI6e5KKd.js";import{B as xe}from"./BottomNav-DrspHnQU.js";import{C as Q}from"./ChordBadge-CpdYEsQY.js";import{I as fe}from"./input-D6t92-pF.js";import{B as j}from"./badge-BU1YdHVn.js";import{s as N,p as pe}from"./seedTracks-B22TRa5Y.js";import{u as ge,n as $}from"./useSpotifyUser-DOELc333.js";import{s as X}from"./spotifySearchService-mwupN4jQ.js";import{s as je}from"./youtubeSearchService-C_W3FhdG.js";import{R as Z}from"./ResponsiveLayout-Dqs3xQqw.js";import{M as W}from"./music-kwvnLi8E.js";import{T as K}from"./trending-up-7xvoSJTs.js";import{S as ee}from"./search-B6yafTIf.js";import{A as ye}from"./index-_2dnxds6.js";import{Z as se}from"./zap-KndskwKD.js";import{H as te}from"./heart-CutDkfLo.js";import{S as Ne}from"./sparkles-BmjmEley.js";import{C as ve}from"./clock-FrRs4NZi.js";import{A as we}from"./arrow-right-dZ6P8eRf.js";import{E as re}from"./external-link-BhkerGxg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=de("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),O="clade_search_history",Ce=20;function _(){try{const d=localStorage.getItem(O);return d?JSON.parse(d).sort((x,a)=>a.timestamp-x.timestamp):[]}catch(d){return console.error("Error loading search history:",d),[]}}function Se(d){try{const c=_();if(c.slice(0,5).some(n=>n.query.toLowerCase()===d.query.toLowerCase()&&n.type===d.type))return;const v=[{...d,id:`${Date.now()}-${Math.random()}`,timestamp:Date.now()},...c].slice(0,Ce);localStorage.setItem(O,JSON.stringify(v))}catch(c){console.error("Error saving search history:",c)}}function ke(d){try{const x=_().filter(a=>a.id!==d);localStorage.setItem(O,JSON.stringify(x))}catch(c){console.error("Error removing from search history:",c)}}function Ue(){const d=me(),{user:c}=ue(),{data:x}=ge(),[a,v]=o.useState(""),[n,P]=o.useState("song"),[p,L]=o.useState([]),[ae,I]=o.useState(0),[D,w]=o.useState(0),[le,R]=o.useState([]),[b,z]=o.useState(!1),[V,A]=o.useState([]),[f,C]=o.useState([]),[m,F]=o.useState("all"),[u,E]=o.useState("all"),[Y,ie]=o.useState(!1);o.useEffect(()=>{A(_())},[]),o.useEffect(()=>{console.log("ðŸ” SearchPage mounted"),console.log("ðŸ“Š seedTracks count:",N.length),console.log("ðŸ“¦ First track:",N[0])},[]),o.useEffect(()=>{if(n!=="song"||!a.trim()||!c||!x){L([]),I(0),w(0);return}w(0);const s=setTimeout(async()=>{z(!0);try{const{tracks:t,total:r}=await X(c.id,a,50,0);L(t),I(r),w(t.length)}catch(t){console.error("Spotify search error:",t),L([]),I(0),w(0)}finally{z(!1)}},300);return()=>clearTimeout(s)},[a,n,c,x]);const ne=useCallback(async()=>{if(c){z(!0);try{const{tracks:s,total:t}=await X(c.id,a,50,D);L(r=>[...r,...s]),I(t),w(r=>r+s.length)}catch(s){console.error("Spotify load-more error:",s)}finally{z(!1)}}},[c,a,D]);o.useEffect(()=>{let s=!1;if(n!=="song"||!a.trim()||x){R([]);return}const t=setTimeout(async()=>{try{const r=await je(a,"");if(s)return;const l=r.map(i=>({id:`youtube:${i.videoId}`,title:i.title,artist:i.channel,youtube_id:i.videoId,provider:"youtube"}));R(l)}catch(r){console.error("YouTube search error:",r),R([])}},300);return()=>{s=!0,clearTimeout(t)}},[a,n,x]);const y=o.useMemo(()=>{let s=[];if(n==="song"){const t=a.toLowerCase();s=N.filter(r=>{var l,i,S,k,T;return!a.trim()||((l=r.title)==null?void 0:l.toLowerCase().includes(t))||((i=r.artist)==null?void 0:i.toLowerCase().includes(t))||((S=r.album)==null?void 0:S.toLowerCase().includes(t))||((k=r.genre)==null?void 0:k.toLowerCase().includes(t))||((T=r.genre_description)==null?void 0:T.toLowerCase().includes(t))})}else{const t=a.toUpperCase().split(/[-â€“â€”,\s]+/).map(r=>r.trim()).filter(Boolean);s=N.filter(r=>{if(!r.progression_roman)return!1;const l=r.progression_roman.map(i=>i.toUpperCase());return t.length===0||t.every(i=>l.includes(i)||l.includes(i.toLowerCase()))})}if(f.length>0&&(s=s.filter(t=>{const r=[t.genre,...t.genres||[]].filter(Boolean).map(l=>l==null?void 0:l.toLowerCase());return f.some(l=>r.some(i=>i==null?void 0:i.includes(l.toLowerCase())))})),m!=="all"&&(s=s.filter(t=>typeof t.energy!="number"?!1:m==="high"?t.energy>.7:m==="medium"?t.energy>=.4&&t.energy<=.7:m==="low"?t.energy<.4:!0)),u!=="all"&&(s=s.filter(t=>typeof t.valence!="number"?!1:u==="happy"?t.valence>.6:u==="sad"?t.valence<.4:u==="neutral"?t.valence>=.4&&t.valence<=.6:!0)),a.trim()&&n==="song"){const t=a.toLowerCase();return s.sort((r,l)=>{var q,G,U,J;const i=((q=r.title)==null?void 0:q.toLowerCase())||"",S=((G=l.title)==null?void 0:G.toLowerCase())||"",k=((U=r.artist)==null?void 0:U.toLowerCase())||"",T=((J=l.artist)==null?void 0:J.toLowerCase())||"";return i.startsWith(t)&&!S.startsWith(t)?-1:!i.startsWith(t)&&S.startsWith(t)?1:k.startsWith(t)&&!T.startsWith(t)?-1:!k.startsWith(t)&&T.startsWith(t)?1:0})}return s},[a,n,f,m,u]),H=s=>{a.trim()&&(Se({query:a.trim(),type:n,track:n==="song"?s:void 0}),A(_()));const t=s.id||s.spotify_id||s.external_id;t&&$(d,t)},oe=(s,t)=>{t.stopPropagation(),ke(s),A(_())},ce=s=>{s.track?$(d,s.track.id):(v(s.query),P(s.type))};return e.jsxs("div",{className:"min-h-screen bg-background pb-24",children:[e.jsx("header",{className:"sticky top-0 z-40 glass-strong safe-top",children:e.jsx(Z,{maxWidth:"full",children:e.jsxs("div",{className:"py-4 space-y-3",children:[e.jsx("h1",{className:"text-xl lg:text-2xl font-bold",children:"Search"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:n==="song"?"default":"outline",size:"sm",onClick:()=>P("song"),className:"flex-1",children:[e.jsx(W,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Song / Artist"}),e.jsx("span",{className:"sm:hidden",children:"Song"})]}),e.jsxs(h,{variant:n==="chord"?"default":"outline",size:"sm",onClick:()=>P("chord"),className:"flex-1",children:[e.jsx(K,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Chord Progression"}),e.jsx("span",{className:"sm:hidden",children:"Chords"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(fe,{placeholder:n==="song"?"Search songs or artists...":"e.g., vi-IV-I-V or I-V-vi-IV",value:a,onChange:s=>v(s.target.value),className:"pl-10 bg-muted/50",autoFocus:!0})]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>ie(!Y),className:"w-full",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Filters",(f.length>0||m!=="all"||u!=="all")&&e.jsx(j,{variant:"secondary",className:"ml-2",children:f.length+(m!=="all"?1:0)+(u!=="all"?1:0)})]}),e.jsx(ye,{children:Y&&e.jsx(g.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Genre",f.length>0&&e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>C([]),className:"h-6 text-xs",children:"Clear"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["pop","rock","hip hop","r&b","jazz","funk","soul","blues","country","disco","synthpop","reggae","punk"].map(s=>e.jsx(j,{variant:f.includes(s)?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{C(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},children:s},s))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Energy"]}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"All"},{value:"high",label:"High Energy"},{value:"medium",label:"Medium"},{value:"low",label:"Chill"}].map(s=>e.jsx(j,{variant:m===s.value?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>F(s.value),children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Mood"]}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"All",icon:Ne},{value:"happy",label:"Happy",icon:"ðŸ˜Š"},{value:"neutral",label:"Neutral",icon:"ðŸ˜"},{value:"sad",label:"Melancholic",icon:"ðŸ˜¢"}].map(s=>e.jsxs(j,{variant:u===s.value?"default":"outline",className:"cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>E(s.value),children:[typeof s.icon=="string"?s.icon:""," ",s.label]},s.value))})]})]})})})]})})}),e.jsx("main",{className:"py-4 space-y-6",children:e.jsxs(Z,{maxWidth:"full",children:[!a&&V.length>0&&e.jsxs("section",{children:[e.jsxs("h2",{className:"text-sm font-semibold text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Recent Searches"]}),e.jsx("div",{className:"space-y-2",children:V.slice(0,10).map((s,t)=>e.jsx(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.03},onClick:()=>ce(s),className:"p-3 glass rounded-lg cursor-pointer hover:bg-muted/50 transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted/50 flex items-center justify-center flex-shrink-0",children:s.type==="song"?e.jsx(W,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(K,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("div",{className:"flex-1 min-w-0",children:s.track?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium truncate",children:s.track.title}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s.track.artist})]}):e.jsx("div",{className:"font-medium",children:s.query})}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",onClick:r=>oe(s.id,r),children:e.jsx(B,{className:"w-4 h-4"})})]})},s.id))})]}),n==="chord"&&!a&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Popular Progressions"}),e.jsx("div",{className:"space-y-2",children:pe.slice(0,5).map((s,t)=>e.jsxs(g.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.05},onClick:()=>v(s.progression.join("-")),className:"w-full p-4 glass rounded-xl text-left group hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx(we,{className:"w-4 h-4 text-muted-foreground group-hover:text-foreground transition-colors"})]}),e.jsx("div",{className:"flex gap-1.5 flex-wrap",children:s.progression.map((r,l)=>e.jsx(Q,{chord:r,size:"sm"},l))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:s.description})]},s.name))})]}),a&&p.length===0&&y.length===0&&!b&&e.jsx("section",{children:e.jsxs("div",{className:"glass rounded-2xl p-8 text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mx-auto",children:e.jsx(ee,{className:"w-10 h-10 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold mb-2",children:['No results for "',a,'"']}),f.length>0||m!=="all"||u!=="all"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"No tracks match your search with the selected filters"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>{C([]),F("all"),E("all")},children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:["Searched ",N.length," tracks with chord progressions"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Try searching for artist names like "weeknd" or chord progressions like "vi-IV-I-V"'})]})]}),!x&&e.jsxs("div",{className:"glass-strong rounded-xl p-6 space-y-3 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-[#1DB954]",children:[e.jsx(re,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Unlock unlimited search"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect Spotify to search millions of songs beyond the local database"}),e.jsx(h,{onClick:()=>d("/profile"),className:"w-full bg-[#1DB954] hover:bg-[#1ed760] text-white",size:"lg",children:"Connect Spotify"})]})]})}),(p.length>0||y.length>0)&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-sm font-semibold text-muted-foreground flex items-center gap-2 flex-wrap",children:["Results (",p.length+y.length,")",b&&e.jsx(he,{className:"w-3 h-3 animate-spin"}),p.length>0&&e.jsx("span",{className:"text-[#1DB954] text-xs",children:"via Spotify"}),y.length>0&&e.jsx("span",{className:"text-xs text-purple-500",children:"via Local DB"})]}),(f.length>0||m!=="all"||u!=="all")&&e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{C([]),F("all"),E("all")},className:"h-7 text-xs",children:"Clear Filters"})]}),(f.length>0||m!=="all"||u!=="all")&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[f.map(s=>e.jsxs(j,{variant:"secondary",className:"text-xs",children:[s,e.jsx(B,{className:"w-3 h-3 ml-1 cursor-pointer",onClick:()=>C(t=>t.filter(r=>r!==s))})]},s)),m!=="all"&&e.jsxs(j,{variant:"secondary",className:"text-xs",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),m," energy",e.jsx(B,{className:"w-3 h-3 ml-1 cursor-pointer",onClick:()=>F("all")})]}),u!=="all"&&e.jsxs(j,{variant:"secondary",className:"text-xs",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),u,e.jsx(B,{className:"w-3 h-3 ml-1 cursor-pointer",onClick:()=>E("all")})]})]}),e.jsxs("div",{className:"space-y-2",children:[p.map((s,t)=>e.jsx(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>H(s),children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist}),s.album&&e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:s.album})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(M,{className:"w-4 h-4 text-muted-foreground"})})]})},s.id)),p.length<ae&&e.jsx("div",{className:"flex justify-center py-2",children:e.jsx(h,{variant:"outline",size:"sm",onClick:ne,disabled:b,children:b?"Loadingâ€¦":"Load more Spotify results"})}),le.map((s,t)=>e.jsx(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>H(s),children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(M,{className:"w-4 h-4 text-muted-foreground"})})]})},s.id)),y.map((s,t)=>e.jsx(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl",children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist}),s.progression_roman&&e.jsx("div",{className:"flex gap-1 mt-2 flex-wrap",children:s.progression_roman.map((r,l)=>e.jsx(Q,{chord:r,size:"sm",keySignature:s.detected_key},l))})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>H(s),title:"Play on streaming service",children:e.jsx(M,{className:"w-4 h-4"})}),s.url_youtube&&e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>window.open(s.url_youtube,"_blank"),title:"Open on YouTube",children:e.jsx(re,{className:"w-3.5 h-3.5"})})]})]})},s.id))]})]}),a&&p.length===0&&y.length===0&&!b&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("p",{className:"text-muted-foreground",children:['No results found for "',a,'"']}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:!x&&c?"Connect Spotify for full catalog access":"Try a different search term"})]}),!a&&n==="song"&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Trending Tracks"}),e.jsx("div",{className:"space-y-2",children:N.slice(0,10).map((s,t)=>e.jsx(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.03},className:"p-4 glass rounded-xl",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-8 text-lg font-bold text-muted-foreground",children:t+1}),s.cover_url&&e.jsx("img",{src:s.cover_url,alt:"",className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.artist})]}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8 flex-shrink-0",onClick:()=>H(s),title:"Play on streaming service",children:e.jsx(M,{className:"w-4 h-4"})})]})},s.id))})]})]})}),e.jsx(xe,{})]})}export{Ue as default};
