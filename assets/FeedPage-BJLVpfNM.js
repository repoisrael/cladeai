import{j as e,m as S,a as _,u as z,r as f,B as j,X as J,b as W,C as K,d as V}from"./index-Dj8i9Zc4.js";import{T as q}from"./TrackCard-DOidTllv.js";import{u as O,S as Q}from"./useTracks-Cm_YnurP.js";import{B as P}from"./BottomNav-CX5JIzXO.js";import{A as B}from"./index-BM1A0ILA.js";import{S as Z}from"./sparkles-CQdXV3Bu.js";import{U as ee}from"./TrackComments-BscLuHoz.js";import{u as se,R as L}from"./useSpotifyUser-CKOH3Pdn.js";import{u as te}from"./useTasteDNA-DWiv8bjq.js";import{C as ie}from"./circle-alert-D3XZQebw.js";import{M as ne}from"./music-LXRIxicq.js";import{L as ae}from"./log-in-n-gOLlto.js";import"./ChordBadge-Lhv8Qwgn.js";import"./rotate-ccw-BtCCnpyV.js";import"./switch-BfuCjtrV.js";import"./index-CaROvylw.js";import"./Combination-HHj7qFcn.js";import"./index-BbjEgT3Q.js";import"./avatar-CMVVhhdc.js";import"./scroll-area-CTz6GEYK.js";import"./index-gwl7iXBH.js";import"./index-BdQq_4o_.js";import"./useFollowing-ss54_7Dy.js";import"./useMutation-156PItBq.js";import"./label-Cil4-Bnh.js";import"./users-FfPgLT03.js";import"./map-pin-BcPjG6G_.js";import"./radio-CsLQulSL.js";import"./formatDistanceToNow-3UBXKcFR.js";import"./en-US-wfBU2YNu.js";import"./share-2-C-LaA3cG.js";import"./check-Nrw_wVBI.js";import"./twitter-BnVXUYND.js";import"./send-BNQjGGJK.js";import"./QuickStreamButtons-LvaJHLAR.js";import"./providers-CHelMshW.js";import"./timeFormat-BXo_t6_Q.js";import"./music-2-DTYHNbXO.js";import"./CladeIcon-BlAzalTT.js";import"./heart-QLeM9E1W.js";import"./waves-hf-wLccx.js";import"./bookmark-CPib2XCK.js";import"./search-bPaoKplp.js";import"./seedTracks-B22TRa5Y.js";import"./youtubeSearchService-DRbD2XhV.js";import"./textarea-mYNcttOs.js";import"./badge-DUCCD4sp.js";import"./index-ObiEeBMb.js";import"./chevron-right-CM23vbhy.js";import"./trash-2-Dximh65L.js";function re(){return e.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 z-0",children:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-secondary to-background animate-shimmer"})}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col justify-end p-6 pb-8 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},className:"h-8 w-3/4 bg-muted/50 rounded-lg animate-shimmer"}),e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05},className:"h-6 w-1/2 bg-muted/50 rounded-lg animate-shimmer"})]}),e.jsx("div",{className:"h-12 w-36 bg-muted/50 rounded-xl animate-shimmer"}),e.jsxs("div",{className:"glass-strong rounded-2xl p-4 space-y-3",children:[e.jsx("div",{className:"h-4 w-24 bg-muted/50 rounded animate-shimmer"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(s=>e.jsx("div",{className:"h-8 w-12 bg-muted/50 rounded-lg animate-shimmer",style:{animationDelay:`${s*100}ms`}},s))})]}),e.jsx("div",{className:"flex items-center justify-between pt-4",children:[1,2,3,4,5].map(s=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 bg-muted/50 rounded-full animate-shimmer"}),e.jsx("div",{className:"w-10 h-3 bg-muted/50 rounded animate-shimmer"})]},s))})]})]})}function oe(){const{guestMode:s,user:o}=_(),c=z(),[n,r]=f.useState(()=>{const v=localStorage.getItem("clade_guest_banner_dismissed");if(!v)return!1;const k=parseInt(v,10),h=24*60*60*1e3;return Date.now()-k<h}),i=s&&!o&&!n,m=()=>{r(!0),localStorage.setItem("clade_guest_banner_dismissed",Date.now().toString())},C=()=>{c("/auth")};return e.jsx(B,{children:i&&e.jsxs(S.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},transition:{type:"spring",damping:20,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 safe-bottom",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsx("div",{className:"absolute inset-0 bg-background/95 backdrop-blur-xl border-t border-border/50"}),e.jsxs("div",{className:"relative max-w-7xl mx-auto px-4 py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-br from-[#00F5FF] to-[#FF00FF]",children:e.jsx(Z,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-0.5",children:"Join the Conversation"}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:"Sign up to comment, like, and connect with music lovers"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(j,{size:"sm",onClick:C,className:"bg-gradient-to-r from-[#00F5FF] to-[#FF00FF] hover:opacity-90 transition-opacity shadow-lg shadow-[#00F5FF]/20",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign Up"}),e.jsx("span",{className:"sm:hidden",children:"Join"})]}),e.jsx(j,{size:"sm",variant:"ghost",onClick:m,className:"text-muted-foreground hover:text-foreground",children:e.jsx(J,{className:"w-4 h-4"})})]})]})]})})}function ce(s,o){if(!o)return{track:s,score:.5,reasons:["New user - exploring catalog"]};let c=0;const n=[];if(s.progression_roman&&o.favoriteProgressions.length>0){const r=s.progression_roman.join("→"),i=o.favoriteProgressions.find(m=>m.progression.join("→")===r);if(i){const m=.4*(i.count/o.totalTracksAnalyzed);c+=m,n.push(`Matches your favorite progression: ${i.progression.join("-")}`)}}if(s.detected_mode&&o.preferredModes.length>0){const r=o.preferredModes.find(i=>i.mode===s.detected_mode);if(r){const i=.2*(r.percentage/100);c+=i,n.push(`${s.detected_mode} mode (${Math.round(r.percentage)}% of your taste)`)}}if(typeof s.energy=="number"&&typeof o.energyPreference=="number"){const r=Math.abs(s.energy-o.energyPreference),i=.2*(1-r);c+=i,r<.2?n.push("Perfect energy match"):r<.4&&n.push("Good energy match")}if(typeof s.tempo=="number"&&typeof o.averageTempo=="number"){const r=Math.abs(s.tempo-o.averageTempo),i=.2*Math.max(0,1-r/100);c+=i,r<15&&n.push("Similar tempo to your favorites")}return c=Math.max(0,Math.min(1,c)),n.length===0&&n.push("Recommended for you"),{track:s,score:c,reasons:n}}function le(s,o,c){const n=s.map(i=>ce(i,o));return n.sort((i,m)=>m.score-i.score),n.map(i=>i.track)}function rs(){const{user:s,loading:o}=_(),c=z(),{data:n,isLoading:r,error:i}=O(50),{data:m,isLoading:C}=se(20),{data:v}=te(),k=(n==null?void 0:n.tracks)??[],h=(m==null?void 0:m.tracks)??[],x=(()=>{let t;if(h.length>0){const a=new Set(h.map(d=>d.spotify_id).filter(Boolean)),p=new Set(h.map(d=>d.id).filter(Boolean)),l=k.filter(d=>!a.has(d.spotify_id)&&!p.has(d.id));t=[...h,...l]}else{const a=new Set;t=k.filter(p=>{const l=p.spotify_id||p.id;return a.has(l)?!1:(a.add(l),!0)})}return s&&v?le(t,v):t})(),I=h.length>0?"spotify":n==null?void 0:n.source,[u,T]=f.useState(0),[D,U]=f.useState(new Map),E=f.useRef(null),[Y,M]=f.useState(!s),{openPlayer:X}=W();f.useEffect(()=>{s&&M(!1)},[s]);const A=t=>{var p;if(!s){M(!0);return}const a=(p=x[u])==null?void 0:p.id;a&&(U(l=>{const d=new Map(l),g=new Set(l.get(a)||[]);return g.has(t)?g.delete(t):g.add(t),d.set(a,g),d}),t==="skip"&&u<x.length-1&&T(l=>l+1))},b=f.useCallback(()=>{u<x.length-1&&T(t=>t+1)},[u,x.length]),w=f.useCallback(()=>{u>0&&T(t=>t-1)},[u]);if(f.useEffect(()=>{const t=a=>{a.target instanceof HTMLInputElement||a.target instanceof HTMLTextAreaElement||(a.key==="ArrowDown"||a.key==="j"?b():(a.key==="ArrowUp"||a.key==="k")&&w())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[b,w]),f.useEffect(()=>{const t=E.current;if(!t)return;let a=0,p=0,l=0;const d=N=>{a=N.touches[0].clientY,p=N.touches[0].clientX,l=Date.now()},g=N=>{const R=N.changedTouches[0].clientY,$=N.changedTouches[0].clientX,F=a-R,H=Math.abs(p-$),G=Date.now()-l;Math.abs(F)>50&&Math.abs(F)>H&&G<500&&(F>0?b():w())};return t.addEventListener("touchstart",d,{passive:!0}),t.addEventListener("touchend",g,{passive:!0}),()=>{t.removeEventListener("touchstart",d),t.removeEventListener("touchend",g)}},[b,w]),o||r)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(re,{}),e.jsx(P,{})]});if(i)return e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center",children:[e.jsxs("div",{className:"text-center p-6",children:[e.jsx(ie,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Failed to load tracks"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try again later"})]}),e.jsx(P,{})]});const y=x[u];return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col touch-pan-y",ref:E,"data-feed":!0,children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-40 glass-strong safe-top",children:e.jsx(L,{maxWidth:"full",children:e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("h1",{className:"text-lg lg:text-xl font-bold gradient-text",children:"HarmonyFeed"}),e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsxs("span",{className:"text-xs lg:text-sm text-muted-foreground flex items-center gap-1",children:[u+1," / ",x.length,I==="spotify"&&e.jsx("span",{className:"ml-1 text-[#1DB954] flex items-center gap-0.5",title:"Your Spotify history",children:e.jsx(ne,{className:"w-3 h-3"})}),I==="seed"&&e.jsx("span",{className:"ml-1 text-amber-500",title:"Using demo data",children:"•"})]}),!s&&e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>c("/auth"),className:"gap-1.5",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sign in"})]})]})]})})}),Y&&!s&&e.jsx("div",{className:"pt-16 px-4",children:e.jsx("div",{className:"mx-auto max-w-3xl rounded-xl border border-border/60 bg-background/70 px-4 py-3 text-sm text-muted-foreground shadow-lg backdrop-blur",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"You’re exploring in guest mode."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sign in to like, comment, follow, and save tracks. Playback and browsing stay open."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{size:"sm",onClick:()=>c("/auth"),children:"Sign in"}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>M(!1),children:"Maybe later"})]})]})})}),e.jsxs("div",{className:"hidden md:flex fixed left-4 top-1/2 -translate-y-1/2 z-30 flex-col gap-2",children:[e.jsx(j,{variant:"outline",size:"icon",className:"glass",onClick:w,disabled:u===0,children:e.jsx(K,{className:"w-5 h-5"})}),e.jsx(j,{variant:"outline",size:"icon",className:"glass",onClick:b,disabled:u===x.length-1,children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsx("main",{className:"flex-1 pt-16 pb-24",children:e.jsx(L,{maxWidth:"full",className:"py-6",children:e.jsx("div",{className:"h-[calc(100vh-12rem)] max-w-lg mx-auto lg:max-w-2xl",children:e.jsx(B,{mode:"wait",children:y&&e.jsx(S.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.3},className:"h-full",children:e.jsx(q,{track:y,isActive:!0,onInteraction:A,interactions:D.get(y.id)||new Set,onPipModeActivate:(t,a)=>{t&&X({canonicalTrackId:y.id,provider:"youtube",providerTrackId:t,autoplay:!0,context:"feed",title:a,artist:y.artist})}})},y.id)})})})}),x[u]&&e.jsx(Q,{roomId:"global",maxVisible:3,scrollSpeed:4e3}),e.jsx(oe,{}),e.jsx(P,{})]})}export{rs as default};
