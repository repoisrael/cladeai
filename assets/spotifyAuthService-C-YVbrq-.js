import{s}from"./index-T1idvDzn.js";const c="https://accounts.spotify.com/api/token";async function f(n){const{data:e,error:o}=await s.from("user_providers").select("*").eq("user_id",n).eq("provider","spotify").single();return o||!e?null:e}async function p(n,e){const o="b1d936a5b2bd4cb199d3ede9a4fa2449";try{const t=await fetch(c,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e,client_id:o})});if(!t.ok){const i=await t.json();return console.error("Failed to refresh Spotify token:",i),null}const r=await t.json(),a=new Date(Date.now()+r.expires_in*1e3).toISOString();return await s.from("user_providers").update({access_token:r.access_token,expires_at:a,...r.refresh_token&&{refresh_token:r.refresh_token}}).eq("user_id",n).eq("provider","spotify"),r.access_token}catch(t){return console.error("Error refreshing Spotify token:",t),null}}async function u(n){const e=await f(n);if(!e)return null;const o=new Date(e.expires_at),t=new Date,r=5*60*1e3;return o.getTime()-t.getTime()<r?await p(n,e.refresh_token):e.access_token}export{f as a,u as g,p as r};
