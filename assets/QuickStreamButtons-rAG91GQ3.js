import{n as H,b as W,a as q,r as v,al as B,j as p,i as T,m as N}from"./index-DJstQ7TQ.js";import{g as Q}from"./providers-CHelMshW.js";import{M as V}from"./music-BcculZu3.js";const D="https://www.googleapis.com/youtube/v3";let S=!1,z=null,C=!1;function A(e){S=!0,z=e,C||(console.warn("[YouTubeSearch] disabled:",e),C=!0)}function Z(e){if(!e)return null;const s=e.trim();if(/^[a-zA-Z0-9_-]{11}$/.test(s))return s;const o=e.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/);if(o!=null&&o[1])return o[1];const t=e.match(/[?&]v=([a-zA-Z0-9_-]{11})/);return t!=null&&t[1]?t[1]:null}async function te(e){var t,u,a,l,n,c;if(S)return null;const s="AIzaSyCuzsSgHYzMsRfDWHtGFlDhkYJfysD8DYw",o=new URLSearchParams({part:"snippet,contentDetails",id:e,key:s});try{const d=await fetch(`${D}/videos?${o}`);if(!d.ok)return(d.status===401||d.status===403)&&A(`YouTube API returned ${d.status} for video lookup`),null;const h=(t=(await d.json()).items)==null?void 0:t[0];if(!h)return null;const i=h.snippet.title||"",[Y,m]=i.includes(" - ")?i.split(" - ",2):[void 0,i],y=((u=h.contentDetails)==null?void 0:u.duration)||"",w=k(y);return{id:`youtube:${e}`,title:m||i,artist:Y||h.snippet.channelTitle,cover_url:((l=(a=h.snippet.thumbnails)==null?void 0:a.high)==null?void 0:l.url)||((c=(n=h.snippet.thumbnails)==null?void 0:n.default)==null?void 0:c.url),youtube_id:e,duration_ms:w,provider:"youtube"}}catch(d){return console.error("getYouTubeVideo error",d),null}}function k(e){try{const s=e.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);if(!s)return 0;const o=parseInt(s[1]||"0",10),t=parseInt(s[2]||"0",10),u=parseInt(s[3]||"0",10);return(o*3600+t*60+u)*1e3}catch{return 0}}async function G(e,s){if(S)return!C&&z&&(console.warn("[YouTubeSearch] skipped because disabled:",z),C=!0),[];const o="AIzaSyCuzsSgHYzMsRfDWHtGFlDhkYJfysD8DYw";try{const t=[],u=Z(s?`${e} ${s}`:e);if(u){const i=await J(u,o);if(i)return[{videoId:u,title:i.title,channel:i.channel,type:"official"}]}const a=`${e} ${s} official`.trim(),l=await j(a,o,3);t.push(...l.map(i=>({...i,type:"official"})));const n=`${e} ${s} live`.trim(),c=await j(n,o,2);t.push(...c.map(i=>({...i,type:"live"})));const d=`${s||e} cover`.trim(),g=await j(d,o,2);return t.push(...g.map(i=>({...i,type:"cover"}))),t.filter((i,Y,m)=>m.findIndex(y=>y.videoId===i.videoId)===Y)}catch(t){return console.error("Error searching YouTube:",t),[]}}async function j(e,s,o){if(S)return[];const t=new URLSearchParams({part:"snippet",q:e,type:"video",videoCategoryId:"10",maxResults:o.toString(),key:s}),u=await fetch(`${D}/search?${t}`);return u.ok?(await u.json()).items.map(l=>({videoId:l.id.videoId,title:l.snippet.title,channel:l.snippet.channelTitle})):(console.error("YouTube API error:",u.status),(u.status===401||u.status===403)&&A(`YouTube API returned ${u.status} for search`),[])}async function J(e,s){var l,n,c;if(S)return null;const o=new URLSearchParams({part:"snippet",id:e,key:s}),t=await fetch(`${D}/videos?${o}`);if(!t.ok)return(t.status===401||t.status===403)&&A(`YouTube API returned ${t.status} for snippet fetch`),null;const a=(l=(await t.json()).items)==null?void 0:l[0];return a?{title:((n=a.snippet)==null?void 0:n.title)||"YouTube video",channel:((c=a.snippet)==null?void 0:c.channelTitle)||"YouTube"}:null}const K=({className:e})=>p.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})}),O=({className:e})=>p.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})});function oe({track:e,canonicalTrackId:s=null,trackTitle:o="Track",trackArtist:t,className:u,size:a="md"}){const l=Q(e),n=l.find(r=>r.provider==="spotify"),c=l.find(r=>r.provider==="youtube");H();const{openPlayer:d,positionMs:g,provider:h,canonicalTrackId:i}=W(),{user:Y}=q(),m=v.useCallback(r=>{if(!r)return null;if(r.startsWith("spotify:track:"))return r.split(":").pop()||null;const f=r.match(/track\/(\w+)/);return f!=null&&f[1]?f[1]:r.includes("?")?r.split("?")[0].split("/").pop()||null:r},[]),y=v.useCallback(r=>{if(!r)return null;const f=r.match(/[?&]v=([A-Za-z0-9_-]{11})/);return f!=null&&f[1]?f[1]:(r.length===11,r)},[]),w=v.useMemo(()=>m(e.spotifyId||e.urlSpotifyWeb||e.urlSpotifyApp||(n==null?void 0:n.webUrl)||(n==null?void 0:n.appUrl)),[m,e.spotifyId,e.urlSpotifyApp,e.urlSpotifyWeb,n==null?void 0:n.appUrl,n==null?void 0:n.webUrl]),P=v.useMemo(()=>y(e.youtubeId||e.urlYoutube||(c==null?void 0:c.webUrl)),[y,e.urlYoutube,e.youtubeId,c==null?void 0:c.webUrl]),b=!!w,x=!!P,_=!b&&!x,$=i===s,I=$&&g?g/1e3:void 0,F=v.useCallback(()=>{!b||!e.spotifyId||(B("spotify"),d({canonicalTrackId:s,provider:"spotify",providerTrackId:w,autoplay:!0,context:"quick-stream",title:o,artist:t,startSec:I}))},[b,s,o,t,d,I,w]),E=v.useCallback(async()=>{var f;B("youtube");let r=P;if(!r)try{r=(f=(await G(t||"",o||""))[0])==null?void 0:f.videoId}catch(U){console.warn("YouTube search failed; falling back to no-op",U)}if(!r){console.warn("No YouTube result found for track; cannot play");return}d({canonicalTrackId:s,provider:"youtube",providerTrackId:r,autoplay:!0,context:"quick-stream",title:o,artist:t,startSec:I})},[s,o,t,d,I,P]),M={sm:"w-8 h-8",md:"w-10 h-10",lg:"w-12 h-12"},R={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return _?p.jsxs("div",{className:T("flex items-center gap-2 text-muted-foreground",u),children:[p.jsx(V,{className:"w-4 h-4"}),p.jsx("span",{className:"text-sm",children:"No streaming links"})]}):p.jsxs("div",{className:T("flex items-center gap-2",u),children:[p.jsx(N.button,{whileHover:{scale:b?1.05:1},whileTap:{scale:b?.97:1},onClick:b?F:void 0,"data-provider":"spotify",disabled:!b,className:T(M[a],"rounded-full flex items-center justify-center transition-all",b?"bg-gradient-to-br from-[#1DB954] to-[#1ed760] text-white shadow-lg hover:shadow-xl hover:from-[#1ed760] hover:to-[#1DB954] cursor-pointer":"bg-muted text-muted-foreground cursor-not-allowed opacity-60",h==="spotify"&&$&&"ring-2 ring-white ring-offset-2 ring-offset-background"),title:b?"Play in Spotify":"Spotify unavailable","aria-label":b?`Play ${o} in Spotify`:"Spotify unavailable",children:p.jsx(K,{className:R[a]})}),p.jsx(N.button,{whileHover:{scale:x?1.05:1},whileTap:{scale:x?.97:1},onClick:E,"data-provider":"youtube",className:T(M[a],"rounded-full flex items-center justify-center transition-all","bg-gradient-to-br from-[#FF0000] to-[#CC0000] text-white shadow-lg hover:shadow-xl hover:from-[#FF0000] hover:to-[#EE0000] cursor-pointer",h==="youtube"&&$&&"ring-2 ring-white ring-offset-2 ring-offset-background"),title:x?"Play on YouTube":"Find on YouTube","aria-label":x?`Play ${o} on YouTube`:`Find ${o} on YouTube`,children:p.jsx(O,{className:R[a]})})]})}export{oe as Q,K as S,te as g,G as s};
