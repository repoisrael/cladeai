import{j as h,b,o as w,p as j,q as k,a as y,h as g}from"./index-Dd2rIlyv.js";const q={sm:"max-w-screen-sm",md:"max-w-screen-md",lg:"max-w-screen-lg",xl:"max-w-[1440px]","2xl":"max-w-screen-2xl",full:"max-w-full"};function M({children:t,maxWidth:e="xl",className:a,padding:n=!0}){return h.jsx("div",{className:b("mx-auto w-full",q[e],n&&"px-4 sm:px-6 lg:px-8",a),children:t})}const A={sm:"gap-3",md:"gap-4 sm:gap-6",lg:"gap-6 sm:gap-8",xl:"gap-8 sm:gap-10"};function N({children:t,cols:e={sm:1,md:2,lg:3},gap:a="md",className:n}){const r=[e.sm&&`grid-cols-${e.sm}`,e.md&&`sm:grid-cols-${e.md}`,e.lg&&`md:grid-cols-${e.lg}`,e.xl&&`lg:grid-cols-${e.xl}`,e["2xl"]&&`xl:grid-cols-${e["2xl"]}`].filter(Boolean).join(" ");return h.jsx("div",{className:b("grid",r,A[a],n),children:t})}const C={narrow:"lg:max-w-2xl",medium:"lg:max-w-3xl",wide:"lg:max-w-4xl"};function D({left:t,center:e,right:a,centerWidth:n="medium",className:r}){return h.jsxs("div",{className:b("grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8",r),children:[t&&h.jsx("aside",{className:"hidden lg:block lg:col-span-3",children:t}),h.jsx("main",{className:b("col-span-1",t&&a?"lg:col-span-6":t||a?"lg:col-span-9":"lg:col-span-12","mx-auto w-full",C[n]),children:e}),a&&h.jsx("aside",{className:"hidden lg:block lg:col-span-3",children:a})]})}const _="https://api.spotify.com/v1";function E(t){const{track:e}=t,a=e.album.images.sort((n,r)=>r.height-n.height)[0];return{id:`spotify:${e.id}`,title:e.name,artist:e.artists.map(n=>n.name).join(", "),artists:e.artists.map(n=>n.name),album:e.album.name,cover_url:a==null?void 0:a.url,artwork_url:a==null?void 0:a.url,duration_ms:e.duration_ms,spotify_id:e.id,url_spotify_web:e.external_urls.spotify,url_spotify_app:e.uri,preview_url:e.preview_url,provider:"spotify",external_id:e.id}}async function v(t,e=20){const a=await w(t);if(!a)return null;try{const n=new URLSearchParams({limit:Math.min(e,50).toString()}),r=await fetch(`${_}/me/player/recently-played?${n}`,{headers:{Authorization:`Bearer ${a}`}});return r.ok?{tracks:(await r.json()).items.map(E),source:"spotify"}:r.status===401?await j(t,"")?v(t,e):(console.error("Spotify token refresh failed"),null):(console.error("Failed to fetch recently played:",r.status),null)}catch(n){return console.error("Error fetching recently played:",n),null}}async function F(t){return await k(t)!==null}async function P(t){var a,n,r;const e=await w(t);if(!e)return null;try{const s=await fetch(`${_}/me`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)return null;const c=await s.json();return{displayName:c.display_name||c.id,email:c.email,imageUrl:(n=(a=c.images)==null?void 0:a[0])==null?void 0:n.url,product:c.product,followers:(r=c.followers)==null?void 0:r.total}}catch(s){return console.error("Error fetching Spotify profile:",s),null}}async function $(t,e="medium_term",a=20){const n=await w(t);if(!n)return[];try{const r=new URLSearchParams({time_range:e,limit:Math.min(a,50).toString()}),s=await fetch(`${_}/me/top/tracks?${r}`,{headers:{Authorization:`Bearer ${n}`}});return s.ok?(await s.json()).items.map(i=>{var p,f;return{id:`spotify:${i.id}`,title:i.name,artist:i.artists.map(o=>o.name).join(", "),artists:i.artists.map(o=>o.name),album:i.album.name,cover_url:(p=i.album.images[0])==null?void 0:p.url,artwork_url:(f=i.album.images[0])==null?void 0:f.url,duration_ms:i.duration_ms,spotify_id:i.id,provider:"spotify",external_id:i.id}}):[]}catch(r){return console.error("Error fetching top tracks:",r),[]}}async function S(t,e="medium_term",a=20){const n=await w(t);if(!n)return[];try{const r=new URLSearchParams({time_range:e,limit:Math.min(a,50).toString()}),s=await fetch(`${_}/me/top/artists?${r}`,{headers:{Authorization:`Bearer ${n}`}});return s.ok?(await s.json()).items:[]}catch(r){return console.error("Error fetching top artists:",r),[]}}async function B(t,e){if(e.length===0)return[];const a=await w(t);if(!a)return[];try{const n=e.slice(0,100).join(","),r=await fetch(`${_}/audio-features?ids=${n}`,{headers:{Authorization:`Bearer ${a}`}});return r.ok?(await r.json()).audio_features.filter(Boolean):[]}catch(n){return console.error("Error fetching audio features:",n),[]}}async function R(t){const[e,a]=await Promise.all([$(t,"medium_term",50),S(t,"medium_term",50)]);if(e.length===0)return null;const n=e.map(l=>l.spotify_id||l.external_id).filter(Boolean),r=await B(t,n);if(r.length===0)return null;const s=r.reduce((l,u)=>l+u.energy,0)/r.length,c=r.reduce((l,u)=>l+u.danceability,0)/r.length,i=r.reduce((l,u)=>l+u.valence,0)/r.length,p=r.reduce((l,u)=>l+u.tempo,0)/r.length,f={};a.forEach(l=>{l.genres.forEach(u=>{f[u]=(f[u]||0)+1})});const o=Object.entries(f).sort((l,u)=>u[1]-l[1]).slice(0,10).map(([l,u])=>({genre:l,count:u}));let m="balanced";s>.7&&i>.6?m="energetic":s<.4&&i>.5?m="chill":i<.35?m="melancholic":i>.65&&c>.6&&(m="upbeat");const d=new Set(e.flatMap(l=>l.artists||[])),x=Math.min(d.size/e.length,1);return{topGenres:o,averageEnergy:s,averageDanceability:c,averageValence:i,averageTempo:p,moodProfile:m,listeningDiversity:x}}async function z(t,e=[],a=[],n=20){const r=await w(t);if(!r)return[];try{let s=e,c=a;if(s.length===0&&c.length===0){const[o,m]=await Promise.all([$(t,"medium_term",5),S(t,"medium_term",5)]);s=o.slice(0,2).map(d=>d.spotify_id||d.external_id).filter(Boolean),c=m.slice(0,3).map(d=>d.id)}const i=[];if(s.length>0&&i.push(`seed_tracks=${s.slice(0,2).join(",")}`),c.length>0&&i.push(`seed_artists=${c.slice(0,3).join(",")}`),i.length===0)return[];const p=await fetch(`${_}/recommendations?${i.join("&")}&limit=${n}`,{headers:{Authorization:`Bearer ${r}`}});return p.ok?(await p.json()).tracks.map(o=>{var m,d;return{id:`spotify:${o.id}`,title:o.name,artist:o.artists.map(x=>x.name).join(", "),artists:o.artists.map(x=>x.name),album:o.album.name,cover_url:(m=o.album.images[0])==null?void 0:m.url,artwork_url:(d=o.album.images[0])==null?void 0:d.url,duration_ms:o.duration_ms,spotify_id:o.id,provider:"spotify",external_id:o.id}}):[]}catch(s){return console.error("Error fetching recommendations:",s),[]}}function T(){const{user:t}=y();return g({queryKey:["spotify-connected",t==null?void 0:t.id],queryFn:()=>F(t.id),enabled:!!t,staleTime:5*60*1e3})}function U(t=20){const{user:e}=y();return g({queryKey:["spotify-recently-played",e==null?void 0:e.id,t],queryFn:()=>v(e.id,t),enabled:!!e,staleTime:2*60*1e3,refetchOnWindowFocus:!0})}function L(){const{user:t}=y();return g({queryKey:["spotify-profile",t==null?void 0:t.id],queryFn:()=>P(t.id),enabled:!!t,staleTime:10*60*1e3})}function O(t="medium_term",e=20){const{user:a}=y(),{data:n}=T();return g({queryKey:["spotify-top-tracks",a==null?void 0:a.id,t,e],queryFn:()=>$(a.id,t,e),enabled:!!a&&n===!0,staleTime:10*60*1e3})}function V(t="medium_term",e=20){const{user:a}=y(),{data:n}=T();return g({queryKey:["spotify-top-artists",a==null?void 0:a.id,t,e],queryFn:()=>S(a.id,t,e),enabled:!!a&&n===!0,staleTime:10*60*1e3})}function W(){const{user:t}=y(),{data:e}=T();return g({queryKey:["music-stats",t==null?void 0:t.id],queryFn:()=>R(t.id),enabled:!!t&&e===!0,staleTime:30*60*1e3})}function G(t=[],e=[],a=20){const{user:n}=y(),{data:r}=T();return g({queryKey:["spotify-recommendations",n==null?void 0:n.id,t,e,a],queryFn:()=>z(n.id,t,e,a),enabled:!!n&&r===!0,staleTime:15*60*1e3})}export{D,M as R,T as a,L as b,O as c,V as d,W as e,G as f,N as g,U as u};
