import{c as R,h as P,s as E,r as x,j as e,b as k,af as O,ax as G,ay as K,az as J,B as C}from"./index-Dd2rIlyv.js";import{P as Q}from"./PageLayout-BNXjs83-.js";import{T as W,a as X,b as f,c as g}from"./tabs-C8trX2jw.js";import{C as c,a as d,d as o,b as m,c as j}from"./card-C6f9biTf.js";import{I as Y}from"./input-BiA0strX.js";import{B as Z}from"./badge-DmFa1swO.js";import{U as M}from"./users-mqB8ZhG2.js";import{M as ee}from"./music-rEZJDJ1O.js";import{H as se}from"./heart-gI87XFQe.js";import{T as A}from"./triangle-alert-nr0ZPO_I.js";import{S as te}from"./search-CInHvpnX.js";import"./BottomNav-3dyL0Vl5.js";import"./CladeIcon-C1_7t6h2.js";import"./index-D7mrrV0m.js";import"./index-DIJ6oIYa.js";import"./index-BLHP4b0R.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=R("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=R("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);async function le(){const{data:a,error:l}=await E.functions.invoke("test-runs?latest=1",{method:"GET",headers:{}});if(l)throw l;return a??[]}async function ne(a=50){const{data:l,error:n}=await E.functions.invoke(`test-runs?limit=${a}`,{method:"GET",headers:{}});if(n)throw n;return l??[]}function ie(){return P({queryKey:["test-runs","latest"],queryFn:le,staleTime:3e4})}function ce(a=50){return P({queryKey:["test-runs","history",a],queryFn:()=>ne(a),staleTime:3e4})}const de=O("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),b=x.forwardRef(({className:a,variant:l,...n},T)=>e.jsx("div",{ref:T,role:"alert",className:k(de({variant:l}),a),...n}));b.displayName="Alert";const oe=x.forwardRef(({className:a,...l},n)=>e.jsx("h5",{ref:n,className:k("mb-1 font-medium leading-none tracking-tight",a),...l}));oe.displayName="AlertTitle";const w=x.forwardRef(({className:a,...l},n)=>e.jsx("div",{ref:n,className:k("text-sm [&_p]:leading-relaxed",a),...l}));w.displayName="AlertDescription";function y({className:a,...l}){return e.jsx("div",{className:k("animate-pulse rounded-md bg-muted",a),...l})}function _e(){const[a,l]=x.useState("overview"),[n,T]=x.useState(""),[v,S]=x.useState(0),h=20,{data:r,isLoading:D}=G(),{data:u=[],isLoading:H,isError:I}=K(),{data:i,isLoading:z,isError:F,refetch:$}=J(n,h,v),{data:q=[]}=ie(),{data:B=[]}=ce(50),p=(i==null?void 0:i.total)??0,L=x.useMemo(()=>p>0?Math.ceil(p/h):1,[p]),_=Math.floor(v/h)+1,V=[{title:"Total Users",value:(r==null?void 0:r.totalUsers)||0,icon:M,color:"text-blue-500"},{title:"Active (7d)",value:(r==null?void 0:r.activeUsers)||0,icon:M,color:"text-green-500"},{title:"Total Tracks",value:(r==null?void 0:r.totalTracks)||0,icon:ee,color:"text-purple-500"},{title:"Total Plays",value:(r==null?void 0:r.totalPlays)||0,icon:ae,color:"text-orange-500"},{title:"Interactions",value:(r==null?void 0:r.totalInteractions)||0,icon:se,color:"text-pink-500"}];return e.jsx(Q,{title:"Admin Dashboard",children:e.jsxs("div",{className:"space-y-6",children:[u&&u.length>0&&e.jsxs(b,{variant:"destructive",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsxs(w,{children:[u.length," items flagged for review. Check the Moderation tab."]})]}),e.jsxs(W,{value:a,onValueChange:l,children:[e.jsxs(X,{className:"grid w-full grid-cols-5",children:[e.jsx(f,{value:"overview",children:"Overview"}),e.jsx(f,{value:"users",children:"Users"}),e.jsx(f,{value:"moderation",children:"Moderation"}),e.jsx(f,{value:"settings",children:"Settings"}),e.jsx(f,{value:"testruns",children:"Test Runs"})]}),e.jsxs(g,{value:"overview",className:"space-y-6",children:[e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:D?Array.from({length:5}).map((s,t)=>e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(y,{className:"h-4 w-20"})}),e.jsx(o,{children:e.jsx(y,{className:"h-8 w-16"})})]},t)):V.map(s=>{const t=s.icon;return e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:s.title}),e.jsx(t,{className:`h-4 w-4 ${s.color}`})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:s.value.toLocaleString()})})]},s.title)})}),e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(m,{children:"Analytics"}),e.jsx(j,{children:"Charts and visualizations will be added here"})]}),e.jsx(o,{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Coming soon: Active users, popular tracks, and system metrics charts"})]})]}),e.jsx(g,{value:"users",className:"space-y-6",children:e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{children:"User Management"}),e.jsx(j,{children:"Search and browse user accounts"})]}),e.jsxs("div",{className:"flex w-full max-w-md gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{value:n,onChange:s=>{T(s.target.value),S(0)},placeholder:"Search username or email",className:"pl-9"})]}),e.jsx(C,{variant:"outline",onClick:()=>$(),children:"Refresh"})]})]}),e.jsxs(o,{children:[F&&e.jsxs(b,{variant:"destructive",className:"mb-4",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(w,{children:"Failed to load users."})]}),z?e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((s,t)=>e.jsx(y,{className:"h-12 w-full"},t))}):i!=null&&i.users&&i.users.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-muted-foreground",children:[e.jsx("th",{className:"py-2 pr-3",children:"Username"}),e.jsx("th",{className:"py-2 pr-3",children:"Email"}),e.jsx("th",{className:"py-2 pr-3",children:"Roles"}),e.jsx("th",{className:"py-2 pr-3",children:"Joined"})]})}),e.jsx("tbody",{children:i.users.map(s=>e.jsxs("tr",{className:"border-t border-border/60",children:[e.jsx("td",{className:"py-2 pr-3 font-medium",children:s.username||"—"}),e.jsx("td",{className:"py-2 pr-3 text-muted-foreground",children:s.email||"—"}),e.jsx("td",{className:"py-2 pr-3 text-muted-foreground",children:Array.isArray(s.user_roles)&&s.user_roles.length>0?s.user_roles.map(t=>t.role).join(", "):"—"}),e.jsx("td",{className:"py-2 pr-3 text-muted-foreground",children:s.created_at?new Date(s.created_at).toLocaleDateString():"—"})]},s.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",v+1,"-",Math.min(v+h,p)," of ",p]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"outline",size:"sm",disabled:_===1,onClick:()=>S(s=>Math.max(s-h,0)),children:"Previous"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Page ",_," / ",L]}),e.jsx(C,{variant:"outline",size:"sm",disabled:_>=L,onClick:()=>S(s=>s+h),children:"Next"})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground gap-2",children:[e.jsx(re,{className:"h-10 w-10"}),e.jsx("p",{children:"No users found"})]})]})]})}),e.jsx(g,{value:"moderation",className:"space-y-6",children:e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(m,{children:"Content Moderation"}),e.jsx(j,{children:"Review flagged content and take action"})]}),e.jsxs(o,{children:[I&&e.jsxs(b,{variant:"destructive",className:"mb-4",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(w,{children:"Failed to load flagged content."})]}),H?e.jsx("div",{className:"space-y-2",children:Array.from({length:3}).map((s,t)=>e.jsx(y,{className:"h-16 w-full"},t))}):u&&u.length>0?e.jsx("div",{className:"space-y-3",children:u.map(s=>{var t,N,U;return e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/40",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((t=s.track)==null?void 0:t.title)||"Unknown track"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:((N=s.track)==null?void 0:N.artist)||"Unknown artist"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Flagged by ",((U=s.user)==null?void 0:U.username)||"Unknown user"," · ",s.created_at?new Date(s.created_at).toLocaleString():"—"]})]}),e.jsx(Z,{variant:"outline",children:"Flag"})]}),s.notes&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:s.notes})]},s.id)})}):e.jsx("p",{className:"text-muted-foreground",children:"No flagged content"})]})]})}),e.jsx(g,{value:"settings",className:"space-y-6",children:e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(m,{children:"System Settings"}),e.jsx(j,{children:"Configure feature flags, rate limits, and system preferences"})]}),e.jsx(o,{children:e.jsx("p",{className:"text-muted-foreground",children:"Settings panel will be added here"})})]})}),e.jsxs(g,{value:"testruns",className:"space-y-6",children:[e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(m,{children:"Latest Test Runs"}),e.jsx(j,{children:"Hourly sanity → pentest → performance"})]}),e.jsx(o,{children:e.jsx("div",{className:"grid md:grid-cols-3 gap-3",children:["sanity","pentest","performance"].map(s=>{const t=q.find(N=>N.suite===s);return e.jsxs("div",{className:"p-4 rounded-lg bg-muted/40 border border-border/60",children:[e.jsx("div",{className:"text-sm font-semibold capitalize",children:s}),e.jsx("div",{className:"text-xl font-bold mt-1",children:(t==null?void 0:t.status)||"unknown"}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:t!=null&&t.started_at?new Date(t.started_at).toLocaleString():"No data"}),(t==null?void 0:t.duration_ms)&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(t.duration_ms/1e3),"s"]})]},s)})})})]}),e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(m,{children:"History (latest 50)"}),e.jsx(j,{children:"Status, timings, and artifact links"})]}),e.jsx(o,{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-muted-foreground",children:[e.jsx("th",{className:"py-2 pr-3",children:"Suite"}),e.jsx("th",{className:"py-2 pr-3",children:"Status"}),e.jsx("th",{className:"py-2 pr-3",children:"Started"}),e.jsx("th",{className:"py-2 pr-3",children:"Duration"}),e.jsx("th",{className:"py-2 pr-3",children:"Commit"}),e.jsx("th",{className:"py-2 pr-3",children:"Artifacts"})]})}),e.jsx("tbody",{children:B.map(s=>{var t;return e.jsxs("tr",{className:"border-t border-border/60",children:[e.jsx("td",{className:"py-2 pr-3 capitalize",children:s.suite}),e.jsx("td",{className:"py-2 pr-3",children:s.status}),e.jsx("td",{className:"py-2 pr-3 text-muted-foreground",children:s.started_at?new Date(s.started_at).toLocaleString():"—"}),e.jsx("td",{className:"py-2 pr-3",children:s.duration_ms?`${Math.round(s.duration_ms/1e3)}s`:"—"}),e.jsx("td",{className:"py-2 pr-3 text-xs font-mono truncate max-w-[120px]",title:s.commit_sha||"",children:((t=s.commit_sha)==null?void 0:t.slice(0,7))||"—"}),e.jsx("td",{className:"py-2 pr-3",children:s.artifacts_url?e.jsx("a",{href:s.artifacts_url,target:"_blank",rel:"noreferrer",className:"text-primary underline text-xs",children:"View"}):"—"})]},`${s.run_id||s.id}-${s.suite}`)})})]})})]})]})]})]})})}export{_e as default};
