import{j as b,i as S,o as h,p as j,q,a as y,g}from"./index-Dj8i9Zc4.js";const A={sm:"max-w-screen-sm",md:"max-w-screen-md",lg:"max-w-screen-lg",xl:"max-w-[1440px]","2xl":"max-w-screen-2xl",full:"max-w-full"};function K({children:t,maxWidth:e="xl",className:r,padding:n=!0}){return b.jsx("div",{className:S("mx-auto w-full",A[e],n&&"px-4 sm:px-6 lg:px-8",r),children:t})}const k={sm:"gap-3",md:"gap-4 sm:gap-6",lg:"gap-6 sm:gap-8",xl:"gap-8 sm:gap-10"};function M({children:t,cols:e={sm:1,md:2,lg:3},gap:r="md",className:n}){const a=[e.sm&&`grid-cols-${e.sm}`,e.md&&`sm:grid-cols-${e.md}`,e.lg&&`md:grid-cols-${e.lg}`,e.xl&&`lg:grid-cols-${e.xl}`,e["2xl"]&&`xl:grid-cols-${e["2xl"]}`].filter(Boolean).join(" ");return b.jsx("div",{className:S("grid",a,k[r],n),children:t})}const _="https://api.spotify.com/v1";function C(t){const{track:e}=t,r=e.album.images.sort((n,a)=>a.height-n.height)[0];return{id:`spotify:${e.id}`,title:e.name,artist:e.artists.map(n=>n.name).join(", "),artists:e.artists.map(n=>n.name),album:e.album.name,cover_url:r==null?void 0:r.url,artwork_url:r==null?void 0:r.url,duration_ms:e.duration_ms,spotify_id:e.id,url_spotify_web:e.external_urls.spotify,url_spotify_app:e.uri,preview_url:e.preview_url,provider:"spotify",external_id:e.id}}async function v(t,e=20){const r=await h(t);if(!r)return null;try{const n=new URLSearchParams({limit:Math.min(e,50).toString()}),a=await fetch(`${_}/me/player/recently-played?${n}`,{headers:{Authorization:`Bearer ${r}`}});return a.ok?{tracks:(await a.json()).items.map(C),source:"spotify"}:a.status===401?await j(t,"")?v(t,e):(console.error("Spotify token refresh failed"),null):(console.error("Failed to fetch recently played:",a.status),null)}catch(n){return console.error("Error fetching recently played:",n),null}}async function E(t){return await q(t)!==null}async function F(t){var r,n,a;const e=await h(t);if(!e)return null;try{const s=await fetch(`${_}/me`,{headers:{Authorization:`Bearer ${e}`}});if(!s.ok)return null;const l=await s.json();return{displayName:l.display_name||l.id,email:l.email,imageUrl:(n=(r=l.images)==null?void 0:r[0])==null?void 0:n.url,product:l.product,followers:(a=l.followers)==null?void 0:a.total}}catch(s){return console.error("Error fetching Spotify profile:",s),null}}async function T(t,e="medium_term",r=20){const n=await h(t);if(!n)return[];try{const a=new URLSearchParams({time_range:e,limit:Math.min(r,50).toString()}),s=await fetch(`${_}/me/top/tracks?${a}`,{headers:{Authorization:`Bearer ${n}`}});return s.ok?(await s.json()).items.map(i=>{var f,p;return{id:`spotify:${i.id}`,title:i.name,artist:i.artists.map(o=>o.name).join(", "),artists:i.artists.map(o=>o.name),album:i.album.name,cover_url:(f=i.album.images[0])==null?void 0:f.url,artwork_url:(p=i.album.images[0])==null?void 0:p.url,duration_ms:i.duration_ms,spotify_id:i.id,provider:"spotify",external_id:i.id}}):[]}catch(a){return console.error("Error fetching top tracks:",a),[]}}async function $(t,e="medium_term",r=20){const n=await h(t);if(!n)return[];try{const a=new URLSearchParams({time_range:e,limit:Math.min(r,50).toString()}),s=await fetch(`${_}/me/top/artists?${a}`,{headers:{Authorization:`Bearer ${n}`}});return s.ok?(await s.json()).items:[]}catch(a){return console.error("Error fetching top artists:",a),[]}}async function P(t,e){if(e.length===0)return[];const r=await h(t);if(!r)return[];try{const n=e.slice(0,100).join(","),a=await fetch(`${_}/audio-features?ids=${n}`,{headers:{Authorization:`Bearer ${r}`}});return a.ok?(await a.json()).audio_features.filter(Boolean):[]}catch(n){return console.error("Error fetching audio features:",n),[]}}async function B(t){const[e,r]=await Promise.all([T(t,"medium_term",50),$(t,"medium_term",50)]);if(e.length===0)return null;const n=e.map(c=>c.spotify_id||c.external_id).filter(Boolean),a=await P(t,n);if(a.length===0)return null;const s=a.reduce((c,u)=>c+u.energy,0)/a.length,l=a.reduce((c,u)=>c+u.danceability,0)/a.length,i=a.reduce((c,u)=>c+u.valence,0)/a.length,f=a.reduce((c,u)=>c+u.tempo,0)/a.length,p={};r.forEach(c=>{c.genres.forEach(u=>{p[u]=(p[u]||0)+1})});const o=Object.entries(p).sort((c,u)=>u[1]-c[1]).slice(0,10).map(([c,u])=>({genre:c,count:u}));let m="balanced";s>.7&&i>.6?m="energetic":s<.4&&i>.5?m="chill":i<.35?m="melancholic":i>.65&&l>.6&&(m="upbeat");const d=new Set(e.flatMap(c=>c.artists||[])),w=Math.min(d.size/e.length,1);return{topGenres:o,averageEnergy:s,averageDanceability:l,averageValence:i,averageTempo:f,moodProfile:m,listeningDiversity:w}}async function R(t,e=[],r=[],n=20){const a=await h(t);if(!a)return[];try{let s=e,l=r;if(s.length===0&&l.length===0){const[o,m]=await Promise.all([T(t,"medium_term",5),$(t,"medium_term",5)]);s=o.slice(0,2).map(d=>d.spotify_id||d.external_id).filter(Boolean),l=m.slice(0,3).map(d=>d.id)}const i=[];if(s.length>0&&i.push(`seed_tracks=${s.slice(0,2).join(",")}`),l.length>0&&i.push(`seed_artists=${l.slice(0,3).join(",")}`),i.length===0)return[];const f=await fetch(`${_}/recommendations?${i.join("&")}&limit=${n}`,{headers:{Authorization:`Bearer ${a}`}});return f.ok?(await f.json()).tracks.map(o=>{var m,d;return{id:`spotify:${o.id}`,title:o.name,artist:o.artists.map(w=>w.name).join(", "),artists:o.artists.map(w=>w.name),album:o.album.name,cover_url:(m=o.album.images[0])==null?void 0:m.url,artwork_url:(d=o.album.images[0])==null?void 0:d.url,duration_ms:o.duration_ms,spotify_id:o.id,provider:"spotify",external_id:o.id}}):[]}catch(s){return console.error("Error fetching recommendations:",s),[]}}function x(){const{user:t}=y();return g({queryKey:["spotify-connected",t==null?void 0:t.id],queryFn:()=>E(t.id),enabled:!!t,staleTime:5*60*1e3})}function U(t=20){const{user:e}=y();return g({queryKey:["spotify-recently-played",e==null?void 0:e.id,t],queryFn:()=>v(e.id,t),enabled:!!e,staleTime:2*60*1e3,refetchOnWindowFocus:!0})}function D(){const{user:t}=y();return g({queryKey:["spotify-profile",t==null?void 0:t.id],queryFn:()=>F(t.id),enabled:!!t,staleTime:10*60*1e3})}function L(t="medium_term",e=20){const{user:r}=y(),{data:n}=x();return g({queryKey:["spotify-top-tracks",r==null?void 0:r.id,t,e],queryFn:()=>T(r.id,t,e),enabled:!!r&&n===!0,staleTime:10*60*1e3})}function N(t="medium_term",e=20){const{user:r}=y(),{data:n}=x();return g({queryKey:["spotify-top-artists",r==null?void 0:r.id,t,e],queryFn:()=>$(r.id,t,e),enabled:!!r&&n===!0,staleTime:10*60*1e3})}function O(){const{user:t}=y(),{data:e}=x();return g({queryKey:["music-stats",t==null?void 0:t.id],queryFn:()=>B(t.id),enabled:!!t&&e===!0,staleTime:30*60*1e3})}function V(t=[],e=[],r=20){const{user:n}=y(),{data:a}=x();return g({queryKey:["spotify-recommendations",n==null?void 0:n.id,t,e,r],queryFn:()=>R(n.id,t,e,r),enabled:!!n&&a===!0,staleTime:15*60*1e3})}export{K as R,x as a,D as b,L as c,N as d,O as e,V as f,M as g,U as u};
